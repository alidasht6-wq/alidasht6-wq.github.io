<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<title>Ø­Ø¨Ø§Ø¨ Ø·Ù„Ø§ÛŒ Û±Û¸ Ø¹ÛŒØ§Ø± â€” Ù†Ø³Ø®Ù‡ Ø±Ø§ÛŒÚ¯Ø§Ù†</title>
<style>
body { font-family: Tahoma; direction: rtl; padding: 20px; background: #f5f5f5; }
button { padding: 10px 20px; font-size: 16px; cursor: pointer; }
.result { margin-top: 15px; font-size: 18px; font-weight: bold; }
.buy { color: green; }
.sell { color: red; }
</style>
</head>
<body>

<h2>Ù…Ø­Ø§Ø³Ø¨Ù‡â€ŒÚ¯Ø± Ø­Ø¨Ø§Ø¨ Ø·Ù„Ø§ÛŒ Û±Û¸ Ø¹ÛŒØ§Ø± (Ù†Ø³Ø®Ù‡ Ø±Ø§ÛŒÚ¯Ø§Ù†)</h2>
<button onclick="calc()">ğŸ”„ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ùˆ Ù…Ø­Ø§Ø³Ø¨Ù‡</button>

<div id="out" class="result">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±...</div>

<script>
async function calc() {
    let out = document.getElementById('out');
    out.innerHTML = "Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§... â³";

    try {

        // --- Ù‚ÛŒÙ…Øª Ø¯Ù„Ø§Ø± Ø§Ø² TGJU ---
        let usdReq = await fetch("https://api.tgju.org/v1/latest/price_dollar_rl");
        let usdJson = await usdReq.json();
        let usd = parseInt(usdJson.data.price.value);

        // --- Ù‚ÛŒÙ…Øª Ø·Ù„Ø§ÛŒ Û±Û¸ Ø¹ÛŒØ§Ø± Ø§Ø² TGJU ---
        let goldReq = await fetch("https://api.tgju.org/v1/latest/geram18");
        let goldJson = await goldReq.json();
        let goldMarket = parseInt(goldJson.data.price.value);

        // --- Ù‚ÛŒÙ…Øª Ø§ÙˆÙ†Ø³ Ø§Ø² API Ø±Ø§ÛŒÚ¯Ø§Ù† ---
        let xauReq = await fetch("https://api.exchangerate.host/latest?base=XAU&symbols=USD");
        let xauJson = await xauReq.json();
        let ounce = xauJson.rates.USD;  // Ù‚ÛŒÙ…Øª 1 Ø§ÙˆÙ†Ø³ Ø·Ù„Ø§ Ø¨Ù‡ Ø¯Ù„Ø§Ø±

        // --- Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù‚ÛŒÙ…Øª Ù†Ø¸Ø±ÛŒ Ú¯Ø±Ù… 18 Ø¹ÛŒØ§Ø± ---
        let theoretical = ((ounce * usd * 0.999) / 31.1035) * 0.75;

        // --- Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø­Ø¨Ø§Ø¨ ---
        let bubble = goldMarket - theoretical;

        // --- ØªØ´Ø®ÛŒØµ Ø®Ø±ÛŒØ¯ / ÙØ±ÙˆØ´ ---
        let status = "";
        if (bubble < 0) status = "<span class='buy'>ğŸ’š Ø²Ù…Ø§Ù† Ø®Ø±ÛŒØ¯</span>";
        else if (bubble > 0) status = "<span class='sell'>ğŸ’” Ø²Ù…Ø§Ù† ÙØ±ÙˆØ´</span>";
        else status = "âš– Ù…ØªØ¹Ø§Ø¯Ù„";

        // --- Ù†Ù…Ø§ÛŒØ´ Ø®Ø±ÙˆØ¬ÛŒ ---
        out.innerHTML = `
            ğŸ’µ Ø¯Ù„Ø§Ø±: ${usd.toLocaleString()} ØªÙˆÙ…Ø§Ù†<br>
            ğŸŸ¡ Ø§ÙˆÙ†Ø³ Ø¬Ù‡Ø§Ù†ÛŒ: ${ounce.toLocaleString()} Ø¯Ù„Ø§Ø±<br>
            ğŸŸ¨ Ø·Ù„Ø§ Û±Û¸ Ø¹ÛŒØ§Ø± Ø¨Ø§Ø²Ø§Ø±: ${goldMarket.toLocaleString()} ØªÙˆÙ…Ø§Ù†<br><br>

            ğŸ“˜ Ù‚ÛŒÙ…Øª Ù†Ø¸Ø±ÛŒ: ${theoretical.toLocaleString()} ØªÙˆÙ…Ø§Ù†<br>
            ğŸ“™ Ù…Ù‚Ø¯Ø§Ø± Ø­Ø¨Ø§Ø¨: ${bubble.toLocaleString()} ØªÙˆÙ…Ø§Ù†<br><br>

            Ù†ØªÛŒØ¬Ù‡: ${status}
        `;

    } catch (err) {
        out.innerHTML = "âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§: " + err;
    }
}
</script>

</body>
</html>
