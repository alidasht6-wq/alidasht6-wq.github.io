<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>๐ ุชุญููฺฏุฑ ุทูุง ฑธ ุนุงุฑ (RSI)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* ุงุณุชุงูโุฏู ุณูุงุฑุด */
        body {
            font-family: 'Tahoma', sans-serif;
            background-color: #f7f9fc;
        }
        #signal-box {
            min-height: 280px;
            transition: all 0.5s ease-in-out;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        /* ฺฉูุงุณโูุง ุฑูฺฏ ุจุฑุง ุณฺฏูุงูโูุง */
        .signal-buy {
            background-color: #d4edda; /* ุณุจุฒ ุฑูุดู */
            border: 2px solid #155724;
            color: #155724; /* ูุชู ุณุจุฒ ุชุฑู */
        }

        .signal-sell {
            background-color: #f8d7da; /* ูุฑูุฒ ุฑูุดู */
            border: 2px solid #721c24;
            color: #721c24; /* ูุชู ูุฑูุฒ ุชุฑู */
        }

        .signal-neutral {
            background-color: #ffeeba; /* ุฒุฑุฏ ุฑูุดู */
            border: 2px solid #856404;
            color: #856404; /* ูุชู ุฒุฑุฏ ุชุฑู */
        }

        .list-group-item {
            font-size: 1.1rem;
            padding: 15px 20px;
        }
        .badge {
            min-width: 150px; /* ูุถุง ฺฉุงู ุจุฑุง ููุชโูุง */
        }
    </style>
</head>
<body class="bg-light">
    <div class="container my-5">
        <header class="text-center mb-5">
            <h1 class="display-4 fw-bold text-primary">๐ฐ ุณุณุชู ุณฺฏูุงู ุทูุง ฑธ ุนุงุฑ</h1>
            <p class="lead">ุชุญูู ู ููุงุด ุณฺฏูุงู ุฎุฑุฏ ู ูุฑูุด ุจุฑ ุงุณุงุณ ููุชโูุง ุฏุงุฎู ู RSI ุฌูุงู</p>
        </header>

        <div class="row">
            <div class="col-lg-6 mb-4">
                <div id="signal-box" class="card shadow p-4 text-center">
                    <h3 class="card-title mb-4 fw-bold">ูุถุนุช ูุญุธูโุง ุณฺฏูุงู</h3>
                    <div id="signal-text" class="display-2 fw-bolder">๐ ุฏุฑ ุญุงู ุฏุฑุงูุช...</div>
                    <p class="mt-4 fs-5" id="signal-description"></p>
                </div>
            </div>

            <div class="col-lg-6 mb-4">
                <div class="card shadow p-4">
                    <h3 class="card-title fw-bold mb-3">ุฏุงุฏูโูุง ฺฉูุฏ ุจุงุฒุงุฑ</h3>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            **ุทูุง ฑธ ุนุงุฑ (ฺฏุฑู):**
                            <span id="price-gold-18k" class="badge bg-primary fs-5">...</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            **ุฏูุงุฑ ุขูุฑฺฉุง (ุชููุงู):**
                            <span id="price-usd" class="badge bg-success fs-5">...</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            **ุงูุณ ุฌูุงู (ุฏูุงุฑ):**
                            <span id="price-ounce" class="badge bg-warning fs-5">...</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            **ููุฏุงุฑ RSI (ุฌูุงู):**
                            <span id="rsi-value" class="badge bg-info fs-5">...</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <footer class="text-center text-muted mt-5">
            <small>ุขุฎุฑู ุจูโุฑูุฒุฑุณุงู: <span id="last-updated">---</span></small>
            <div id="error-message" class="text-danger mt-2"></div>
        </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // =================================================================
        //                 ุจุฎุด ุฌุงูุง ุงุณฺฉุฑูพุช (ููุทู ู API)
        // =================================================================

        const RSI_BUY_THRESHOLD = 30;
        const RSI_SELL_THRESHOLD = 70;

        /**
         * ุชุงุจุน ฑ: ุฏุฑุงูุช ุฏุงุฏูโูุง ููุช ุจุงุฒุงุฑ ุฏุงุฎู (ุทูุง ู ุฏูุงุฑ)
         * !!! ุงู ุจุฎุด ูุงุฒ ุจู ุชูุธู ุฏูู ุจุฑ ุงุณุงุณ ุณุงุฎุชุงุฑ ูพุงุณุฎ API ุดูุง ุฏุงุฑุฏ !!!
         */
        async function fetchIranianData() {
            // API ุงุฑุงุฆู ุดุฏู ุชูุณุท ฺฉุงุฑุจุฑ:
            const IRANIAN_API_URL = 'https://BrsApi.ir/Api/Tsetmc/AllSymbols.php?key=BBzNUXWfiBpUmeXusfw4mkbjXuXjj9nU';

            try {
                const response = await fetch(IRANIAN_API_URL);
                const data = await response.json();

                // ----------------------------------------------------------------------------------
                // !!! ุชูุฌู: ููุทู ุงุณุชุฎุฑุงุฌ ุฏุงุฏู ุฏุฑ ุงูุฌุง ุจุงุฏ ุงุตูุงุญ ุดูุฏ !!!
                // ุงุฒ ุขูุฌุง ฺฉู ุณุงุฎุชุงุฑ ุฏูู ูพุงุณุฎ API ุดูุง ุจุฑุง ููุช ุทูุง ู ุฏูุงุฑ ูุดุฎุต ูุณุชุ 
                // ุดูุง ุจุงุฏ ุจุง ุจุฑุฑุณ ูพุงุณุฎ API (ูุชุบุฑ 'data')ุ ฺฉูุฏูุง ุตุญุญ ุฑุง ุฌุงฺฏุฒู ฺฉูุฏ.
                // ูุนูุงู ุงุฒ ููุงุฏุฑ ูุฑุถ ุงุณุชูุงุฏู ูโุดูุฏ:
                // ----------------------------------------------------------------------------------
                
                // ูุฑุถ ูโฺฉูู ุจุชูุงูู ุงู ููุงุฏุฑ ุฑุง ุฏุฑ ุฏุงุฎู ุดุก 'data' ูพุฏุง ฺฉูู:
                const gold18k = (Math.random() * 20000 + 3000000).toFixed(0); 
                const usdPrice = (Math.random() * 1000 + 60000).toFixed(0);
                const ouncePrice = (Math.random() * 50 + 2000).toFixed(2); // ุงูุณ ุฌูุงู ูุนูููุง ุงุฒ ุงู API ูู ุขุฏ

                return {
                    gold_18k_price: gold18k,
                    usd_price: usdPrice,
                    ounce_price: ouncePrice,
                };
            } catch (error) {
                console.error('ุฎุทุง ุฏุฑ ุฏุฑุงูุช ุฏุงุฏูโูุง ุจุงุฒุงุฑ ุงุฑุงู:', error);
                document.getElementById('error-message').textContent = 'โ๏ธ ุฎุทุง ุฏุฑ ุฏุฑุงูุช ุฏุงุฏูโูุง ุจุงุฒุงุฑ ุงุฑุงู.';
                // ููุงุฏุฑ ูพุด ูุฑุถ ุฏุฑ ุตูุฑุช ุฎุทุง
                return { gold_18k_price: 'N/A', usd_price: 'N/A', ounce_price: 'N/A' };
            }
        }

        /**
         * ุชุงุจุน ฒ: ุฏุฑุงูุช ููุฏุงุฑ RSI ุงุฒ API ุขููุงูุงูุชุฌ
         */
        async function fetchRsiData() {
            // !!! ุญุชูุงู 'YOUR_KEY' ุฑุง ุจุง ฺฉูุฏ API ูุงูุน ุฎูุฏ ุฌุงฺฏุฒู ฺฉูุฏ !!!
            const ALPHA_VANTAGE_KEY = 'YOUR_KEY'; 
            
            if (ALPHA_VANTAGE_KEY === 'YOUR_KEY') {
                document.getElementById('error-message').textContent = 'โ๏ธ ฺฉูุฏ API ุขููุงูุงูุชุฌ ุฑุง ุฌุงฺฏุฒู ฺฉูุฏ.';
                return { rsi: 50 }; // ููุฏุงุฑ ูพุดโูุฑุถ ุชุง ุฒูุงู ุฌุงฺฏุฒู ฺฉูุฏ
            }

            const RSI_API_URL = `https://www.alphavantage.co/query?function=RSI&symbol=XAUUSD&interval=daily&time_period=14&series_type=close&apikey=${ALPHA_VANTAGE_KEY}`;

            try {
                const response = await fetch(RSI_API_URL);
                const data = await response.json();

                if (data['Error Message'] || !data['Technical Analysis: RSI']) {
                    console.error('ุฎุทุง ุฏุฑ ุฏุฑุงูุช RSI ุงุฒ ุขููุงูุงูุชุฌ:', data['Note'] || data['Error Message']);
                    document.getElementById('error-message').textContent = 'โ๏ธ ุฎุทุง ุฏุฑ ุฏุฑุงูุช RSI. ูุญุฏูุฏุช API ุง ฺฉูุฏ ูุงูุนุชุจุฑ.';
                    return { rsi: 50 }; // ููุฏุงุฑ ูพุดโูุฑุถ ุฏุฑ ุตูุฑุช ุฎุทุง
                }

                // ุงุณุชุฎุฑุงุฌ ุขุฎุฑู ููุฏุงุฑ RSI
                const rsiData = data['Technical Analysis: RSI'];
                const latestTimestamp = Object.keys(rsiData)[0];
                const rsiValue = parseFloat(rsiData[latestTimestamp]['RSI']);
                
                return { rsi: rsiValue };

            } catch (error) {
                console.error('ุฎุทุง ูู ุฏุฑ ูุฑุงุฎูุงู ุขููุงูุงูุชุฌ:', error);
                document.getElementById('error-message').textContent = 'โ๏ธ ุฎุทุง ูู ุฏุฑ ุงุชุตุงู ุจู ุขููุงูุงูุชุฌ.';
                return { rsi: 50 };
            }
        }

        /**
         * ุชุงุจุน ณ: ุชููุฏ ุณฺฏูุงู ุจุฑ ุงุณุงุณ ููุฏุงุฑ RSI
         * @param {number} rsi - ููุฏุงุฑ RSI
         * @returns {string} ุณฺฏูุงู (BUY, SELL, NEUTRAL)
         */
        function getSignal(rsi) {
            if (rsi > RSI_SELL_THRESHOLD) {
                return 'SELL';
            } else if (rsi < RSI_BUY_THRESHOLD) {
                return 'BUY';
            } else {
                return 'NEUTRAL';
            }
        }

        /**
         * ุชุงุจุน ด: ุจูโุฑูุฒุฑุณุงู ุฑุงุจุท ฺฉุงุฑุจุฑ (UI)
         */
        function updateUI(iranianData, rsi, signal) {
            // ุจูโุฑูุฒุฑุณุงู ููุชโูุง
            document.getElementById('price-gold-18k').textContent = `${iranianData.gold_18k_price} ุช`;
            document.getElementById('price-usd').textContent = `${iranianData.usd_price} ุช`;
            document.getElementById('price-ounce').textContent = `${iranianData.ounce_price} $`;
            
            // ุจูโุฑูุฒุฑุณุงู RSI
            const rsiValueElement = document.getElementById('rsi-value');
            rsiValueElement.textContent = rsi.toFixed(2);
            // ุชุบุฑ ุฑูฺฏ RSI
            if (rsi > RSI_SELL_THRESHOLD) rsiValueElement.className = 'badge bg-danger fs-5';
            else if (rsi < RSI_BUY_THRESHOLD) rsiValueElement.className = 'badge bg-success fs-5';
            else rsiValueElement.className = 'badge bg-info fs-5';

            // ุจูโุฑูุฒุฑุณุงู ุณฺฏูุงู
            const signalBox = document.getElementById('signal-box');
            const signalText = document.getElementById('signal-text');
            const signalDescription = document.getElementById('signal-description');

            signalBox.className = 'card shadow p-4 text-center'; // ุฑุณุช ฺฉูุงุณโูุง
            
            switch (signal) {
                case 'BUY':
                    signalText.textContent = 'โ ุณฺฏูุงู ุฎุฑุฏ';
                    signalBox.classList.add('signal-buy');
                    signalDescription.textContent = `RSI (${rsi.toFixed(2)}) ุฒุฑ ${RSI_BUY_THRESHOLD} ุงุณุช (ุงุดุจุงุน ูุฑูุด). ุฒูุงู ุจุฑุฑุณ ุจุฑุง ูุฑูุฏ.`;
                    break;
                case 'SELL':
                    signalText.textContent = 'โ ุณฺฏูุงู ูุฑูุด';
                    signalBox.classList.add('signal-sell');
                    signalDescription.textContent = `RSI (${rsi.toFixed(2)}) ุจุงูุง ${RSI_SELL_THRESHOLD} ุงุณุช (ุงุดุจุงุน ุฎุฑุฏ). ุฒูุงู ุจุฑุฑุณ ุจุฑุง ุฎุฑูุฌ.`;
                    break;
                default:
                    signalText.textContent = 'โ๏ธ ุณฺฏูุงู ุฎูุซ';
                    signalBox.classList.add('signal-neutral');
                    signalDescription.textContent = `RSI (${rsi.toFixed(2)}) ุฏุฑ ูุญุฏูุฏู ุชุนุงุฏู (${RSI_BUY_THRESHOLD}-${RSI_SELL_THRESHOLD}) ูุฑุงุฑ ุฏุงุฑุฏ.`;
            }

            // ุจูโุฑูุฒุฑุณุงู ุฒูุงู
            document.getElementById('last-updated').textContent = new Date().toLocaleTimeString('fa-IR');
        }

        /**
         * ุชุงุจุน ุงุตู ุจุฑุง ุงุฌุฑุง ุชุญูู ู ุจูโุฑูุฒุฑุณุงู
         */
        async function runAnalysis() {
            // ฑ. ูุฑุงุฎูุงู ููุฒูุงู ูุฑ ุฏู API ุจุฑุง ุณุฑุนุช ุจุงูุงุชุฑ
            const [iranianDataResponse, rsiDataResponse] = await Promise.all([
                fetchIranianData(),
                fetchRsiData()
            ]);
            
            // ฒ. ุงุณุชุฎุฑุงุฌ ู ุขูุงุฏูโุณุงุฒ ุฏุงุฏูโูุง
            const rsiValue = rsiDataResponse.rsi;
            
            // ณ. ุชููุฏ ุณฺฏูุงู
            const signal = getSignal(rsiValue);

            // ด. ุจูโุฑูุฒุฑุณุงู ุฑุงุจุท ฺฉุงุฑุจุฑ
            updateUI(iranianDataResponse, rsiValue, signal);
        }

        // ุดุฑูุน ุงุฌุฑุง ู ุชูุธู ุจูโุฑูุฒุฑุณุงู ุฎูุฏฺฉุงุฑ ูุฑ ฑฐ ุซุงูู
        runAnalysis(); 
        setInterval(runAnalysis, 10000); // ุจูโุฑูุฒุฑุณุงู ูุฑ ฑฐ ุซุงูู (ุฒูุงู ููุงุณุจ ุจุฑุง ุฌููฺฏุฑ ุงุฒ ูุญุฏูุฏุช API)
    </script>
</body>
</html>