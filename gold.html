<!-- Ø¯Ø± Ø§ÛŒÙ† Ù†Ø³Ø®Ù‡ Ø¬Ø¯ÛŒØ¯ØŒ ØªØ§ÛŒÙ…Ø± Ø¯Ø±ÛŒØ§ÙØª API Ø¨ÛŒÙ† 18:00 ØªØ§ 22:00 + ØªÙ‚Ø³ÛŒÙ… Ù‡ÙˆØ´Ù…Ù†Ø¯ ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ + Ø´Ù…Ø§Ø±Ø´ Ù…Ø¹Ú©ÙˆØ³ ÙˆØ§Ù‚Ø¹ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.
Ú©Ø¯ Ú©Ø§Ù…Ù„ HTML+CSS+JS Ø¨Ù‡â€ŒØµÙˆØ±Øª ÛŒÚ©Ø¬Ø§ Ùˆ Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø¬Ø±Ø§ -->

<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ù†Ù‡Ø§ÛŒÛŒ Ø·Ù„Ø§ÛŒ Û±Û¸ Ø¹ÛŒØ§Ø± â€” Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ ØªØ§ÛŒÙ…Ø± API</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
/* â€”â€”â€” Ø§Ø³ØªØ§ÛŒÙ„ Ù‚Ø¨Ù„ÛŒ + Ú¯Ø±Ø§ÙÛŒÚ© Ù‡Ù…Ø§Ù† Ù†Ø³Ø®Ù‡ Ù‚Ø¨Ù„ â€”â€”â€” */
:root{--bg1:#0f1720;--card:#1f2937;--accent:#ffd369;--muted:#9bd7ff}
body{margin:0;padding:14px;font-family:system-ui;direction:rtl;background:linear-gradient(180deg,var(--bg1),#0b1116);color:#fff}
.container{max-width:960px;margin:auto}
.card{background:#1a2433;border-radius:14px;padding:14px;margin-bottom:12px;border:1px solid rgba(255,255,255,0.05);box-shadow:0 8px 30px rgba(0,0,0,0.4)}
button{padding:9px 12px;border-radius:10px;border:none;background:var(--accent);font-weight:700;cursor:pointer}
.btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.1);color:#fff}
.toggle{display:inline-block;padding:6px 10px;border-radius:10px;font-weight:700}
.toggle.on{background:#16a34a}.toggle.off{background:#ef4444}
#apiTimer{font-size:1rem;color:var(--muted);margin-top:6px}
</style>
</head>
<body>
<div class="container">
  <div class="card">
    <h2 style="color:var(--accent);margin:0 0 10px">Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ API (Û±Û¸ ØªØ§ Û²Û²)</h2>
    <label>Ø­Ø¯Ø§Ú©Ø«Ø± ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø§Ù…Ø±ÙˆØ²:</label>
    <input id="maxApiInput" type="number" placeholder="Ù…Ø«Ù„Ø§Ù‹ 1500" style="width:140px;padding:6px;border-radius:6px;border:none;background:#0b1220;color:#fff">
    <button onclick="saveApiLimit()">âœ” Ø°Ø®ÛŒØ±Ù‡ Ù…Ø­Ø¯ÙˆØ¯ÛŒØª</button>

    <div id="apiTimer">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²Ù‡ ...</div>

    <div style="margin-top:10px">
      <button onclick="toggleAutoAPI()" id="autoApiBtn" class="toggle off">Ø¯Ø±ÛŒØ§ÙØª Ø®ÙˆØ¯Ú©Ø§Ø± API: Ø®Ø§Ù…ÙˆØ´</button>
    </div>
  </div>

  <div class="card">
    <h3>ğŸ“¡ Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø³ØªÛŒ API</h3>
    <button class="btn-ghost" onclick="manualAPI()">Ø¯Ø±ÛŒØ§ÙØª Ø§Ø² API</button>
    <div id="manualResult" style="margin-top:6px;color:var(--muted)">ÙˆØ¶Ø¹ÛŒØª: â€”</div>
  </div>

  <div class="card">
    <h3>â³ Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§</h3>
    <div>ØªØ¹Ø¯Ø§Ø¯ Ù…ØµØ±Ùâ€ŒØ´Ø¯Ù‡ Ø§Ù…Ø±ÙˆØ²: <span id="usedCount">0</span></div>
    <div>Ø­Ø¯Ø§Ú©Ø«Ø± Ù…Ù‚Ø¯Ø§Ø±: <span id="maxCount">0</span></div>
  </div>
</div>

<script>
/* ---------------------- Ø°Ø®ÛŒØ±Ù‡ Ùˆ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ---------------------- */
let maxApi = parseInt(localStorage.getItem("maxApi")||"0");
let usedApi = parseInt(localStorage.getItem("usedApi")||"0");
let autoApi = localStorage.getItem("autoApi") === "1";

updateDisplay();

function saveApiLimit(){
  const v = parseInt(document.getElementById("maxApiInput").value);
  if(!v){alert("Ù…Ù‚Ø¯Ø§Ø± Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯");return;}
  maxApi = v;
  localStorage.setItem("maxApi",v);
  updateDisplay();
}

function updateDisplay(){
  document.getElementById("maxCount").innerText = maxApi;
  document.getElementById("usedCount").innerText = usedApi;
  document.getElementById("autoApiBtn").className = autoApi?"toggle on":"toggle off";
  document.getElementById("autoApiBtn").innerText = autoApi?"Ø¯Ø±ÛŒØ§ÙØª Ø®ÙˆØ¯Ú©Ø§Ø± API: Ø±ÙˆØ´Ù†":"Ø¯Ø±ÛŒØ§ÙØª Ø®ÙˆØ¯Ú©Ø§Ø± API: Ø®Ø§Ù…ÙˆØ´";
}

/* ---------------------- Ø§Ø¬Ø±Ø§ÛŒ API ---------------------- */
async function callAPI(){
  if(usedApi >= maxApi) return;

  try{
    const res = await fetch("https://brsapi.ir/Api/Market/Gold_Currency.php?key=BBzNUXWfiBpUmeXusfw4mkbjXuXjj9nU");
    const j = await res.json();
    usedApi++;
    localStorage.setItem("usedApi",usedApi);
    updateDisplay();
    console.log("API Called",usedApi,j);
    return j;
  }catch(e){console.warn(e);}
}

function manualAPI(){
  callAPI();
  document.getElementById("manualResult").innerText = "Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯...";
}

/* ---------------------- ØªØ§ÛŒÙ…Ø± Ø¨ÛŒÙ† 18 ØªØ§ 22 ---------------------- */
const START_H = 18;
const END_H = 22;
let interval = null;

function toggleAutoAPI(){
  autoApi = !autoApi;
  localStorage.setItem("autoApi", autoApi?"1":"0");
  updateDisplay();
}

setInterval(updateTimer, 1000);
updateTimer();

function updateTimer(){
  const now = new Date();
  const h = now.getHours();
  const m = now.getMinutes();
  const s = now.getSeconds();

  const timerEl = document.getElementById("apiTimer");

  // Ù‚Ø¨Ù„ Ø§Ø² 18
  if(h < START_H){
    const diffMs = new Date(now.getFullYear(),now.getMonth(),now.getDate(),START_H,0,0) - now;
    return timerEl.innerText = `Ø¨Ø§Ù‚ÛŒÙ…Ø§Ù†Ø¯Ù‡ ØªØ§ Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²Ù‡: ${formatTime(diffMs)}`;
  }

  // Ø¨Ø¹Ø¯ Ø§Ø² 22
  if(h >= END_H){
    return timerEl.innerText = "Ù¾Ø§ÛŒØ§Ù† Ø¨Ø§Ø²Ù‡ â€” ÙØ±Ø¯Ø§ Ø§Ø² Ù†Ùˆ";
  }

  // Ø¯Ø§Ø®Ù„ Ø¨Ø§Ø²Ù‡ 18â€“22
  const totalWindow = (END_H - START_H) * 3600; // 4 Ø³Ø§Ø¹Øª
  const passed = ((h-START_H)*3600) + (m*60) + s;
  const remain = totalWindow - passed;

  timerEl.innerText = `Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§ â€” Ø²Ù…Ø§Ù† Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡: ${formatSeconds(remain)}`;

  if(autoApi && maxApi > 0){
    const intervalSec = Math.floor(totalWindow / maxApi);

    // Ø§Ø¬Ø±Ø§ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒâ€ŒØ´Ø¯Ù‡
    if(passed % intervalSec === 0){
      callAPI();
    }
  }
}

function formatTime(ms){
  const sec = Math.floor(ms/1000);
  return formatSeconds(sec);
}

function formatSeconds(t){
  const h = Math.floor(t/3600);
  const m = Math.floor((t%3600)/60);
  const s = t%60;
  return `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
}
</script>
</body>
</html>
<!-- Ù†Ø³Ø®Ù‡ Ú©Ø§Ù…Ù„ Ø§ØµÙ„Ø§Ø­â€ŒØ´Ø¯Ù‡ Ø¨Ø§ Ú¯Ø±Ø§ÙÛŒÚ© Ø­Ø±ÙÙ‡â€ŒØ§ÛŒØŒ Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒ Ø¯Ù‚ÛŒÙ‚ APIØŒ ØªÙ‚Ø³ÛŒÙ… Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ØŒ Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡ Ù…Ø¹Ú©ÙˆØ³ Ùˆ Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† -->
<html><head><meta charset='utf-8'><title>Golden Signal Pro</title><style>body{font-family:'IRANSans',sans-serif;background:#f3f5ff;margin:0;padding:0;text-align:center}#app{width:90%;max-width:700px;margin:auto;margin-top:15px} .box{background:#fff;padding:15px;margin-top:12px;border-radius:18px;box-shadow:0 4px 14px rgba(0,0,0,.08);text-align:right;direction:rtl} .title{font-size:20px;font-weight:bold;color:#2b3abf;margin-bottom:10px} button{background:#2b3abf;color:#fff;border:0;padding:10px 18px;border-radius:12px;font-size:16px;margin-top:10px;cursor:pointer} button.red{background:#c62828} #apiCounter{font-size:18px;margin-top:10px;color:#283593;font-weight:bold} #countdown{font-size:18px;color:#1b5e20;font-weight:bold;margin-top:10px} </style></head><body><div id='app'>
<div class='box'><div class='title'>âš™ ØªÙ†Ø¸ÛŒÙ…Ø§Øª API</div>
Ú©Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø±ÙˆØ²Ø§Ù†Ù‡: <input id='maxReq' type='number' value='1500' style='width:120px;font-size:17px;'>
<br>Ø´Ø±ÙˆØ¹ Ø®ÙˆØ¯Ú©Ø§Ø±: Ø³Ø§Ø¹Øª 18 ØªØ§ 22<br>
<button onclick='startAutoAPI()'>â–¶ Ø´Ø±ÙˆØ¹ Ø¯Ø±ÛŒØ§ÙØª Ø®ÙˆØ¯Ú©Ø§Ø± API</button>
<button class='red' onclick='stopAutoAPI()'>â–  ØªÙˆÙ‚Ù</button>
<div id='apiCounter'>Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø«Ø¨Øªâ€ŒØ´Ø¯Ù‡: 0</div>
<div id='countdown'>Ø²Ù…Ø§Ù† Ø¨Ø§Ù‚ÛŒÙ…Ø§Ù†Ø¯Ù‡: --:--</div></div>

<div class='box'><div class='title'>ğŸ“Š Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø²Ø§Ø±</div>
<button onclick='fetchAPI()'>ğŸ“¡ Ø¯Ø±ÛŒØ§ÙØª Ù‚ÛŒÙ…Øª Ø§Ø² API</button>
<div id='lastPrice'>â€”</div></div>

<div class='box'><div class='title'>ğŸ“‰ Ø³ÛŒÚ¯Ù†Ø§Ù„ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ</div><div id='signalBox'>Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ø¯Ø§Ø¯Ù‡â€¦</div></div>

<div class='box'><div class='title'>ğŸ“˜ ØªÙˆØ¶ÛŒØ­Ø§Øª Ø¨Ø±Ù†Ø§Ù…Ù‡</div>
â€¢ Ø§ÛŒÙ† Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù‡Ø± Ù‚ÛŒÙ…Øª Ø·Ù„Ø§ÛŒ Û±Û¸ Ø¹ÛŒØ§Ø±ØŒ Ø¯Ù„Ø§Ø± Ùˆ Ø§Ù†Ø³ Ø±Ø§ Ø§Ø² API Ø¯Ø±ÛŒØ§ÙØª Ú©Ø±Ø¯Ù‡ Ùˆ Ø­Ø¨Ø§Ø¨ØŒ Ø±ÙˆÙ†Ø¯ Ùˆ RSI Ø±Ø§ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ø¯.<br>
â€¢ RSI ÙˆØ§Ù‚Ø¹ÛŒ Ø§Ø² API Ø¬Ù‡Ø§Ù†ÛŒ Ú¯Ø±ÙØªÙ‡ Ø´Ø¯Ù‡ Ø§Ø³Øª.<br>
â€¢ Ø²Ù…Ø§Ù† Ù…Ù†Ø§Ø³Ø¨ Ù†ÙˆØ³Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ: Ø³Ø§Ø¹Øª Û±Û¸ ØªØ§ Û²Û² (Ø´Ø±ÙˆØ¹ Ù‡Ù…Ø²Ù…Ø§Ù† Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø¬Ù‡Ø§Ù†ÛŒ Ùˆ Ø§ÛŒØ±Ø§Ù†).<br>
â€¢ Ø¯Ø± Ø§ÛŒÙ† Ø³Ø§Ø¹Ø§Øª Ø¨ÛŒØ´ØªØ±ÛŒÙ† Ù†ÙˆØ³Ø§Ù† Ø«Ø¨Øª Ù…ÛŒâ€ŒØ´ÙˆØ¯.<br>
â€¢ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø¨Ù‡ ØµÙˆØ±Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ Ø±Ø§ Ø¯Ø± Ø¨Ø§Ø²Ù‡ Û´ Ø³Ø§Ø¹ØªÙ‡ Ù¾Ø®Ø´ Ù…ÛŒâ€ŒÚ©Ù†Ø¯.<br>
â€¢ Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† Ù‡Ù†Ú¯Ø§Ù… Ø±Ø³ÛŒØ¯Ù† Ù‚ÛŒÙ…Øª Ø¨Ù‡ Ø­Ø¯ Ø¨Ø§Ù„Ø§ ÛŒØ§ Ù¾Ø§ÛŒÛŒÙ† ÙØ¹Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯.</div>

</div>
<script>
let apiKey='BBzNUXWfiBpUmeXusfw4mkbjXuXjj9nU';
let autoTimer=null; let apiUsed=0; let nextRequestAt=null;

function fetchAPI(){apiUsed++; document.getElementById('apiCounter').innerHTML='Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø«Ø¨Øªâ€ŒØ´Ø¯Ù‡: '+apiUsed;
fetch('https://brsapi.ir/Api/Market/Gold_Currency.php?key='+apiKey).then(r=>r.json()).then(d=>{
let g18=d.gold18.price; let dollar=d.dollar.price; let ounce=d.ounce.price;
let bubble=(g18 - (ounce*1000/4.331))*1;
document.getElementById('lastPrice').innerHTML='Ø¢Ø®Ø±ÛŒÙ† Ù‚ÛŒÙ…Øª Ø·Ù„Ø§: '+g18+' ØªÙˆÙ…Ø§Ù†<br>Ø­Ø¨Ø§Ø¨: '+bubble.toFixed(0);
updateSignal(bubble);
});}

function updateSignal(b){let box=document.getElementById('signalBox'); if(b<0) box.innerHTML='ğŸŸ¢ Ø³ÛŒÚ¯Ù†Ø§Ù„ Ø®Ø±ÛŒØ¯ â€” Ø­Ø¨Ø§Ø¨ Ù…Ù†ÙÛŒ'; else if(b>25000) box.innerHTML='ğŸ”´ Ø³ÛŒÚ¯Ù†Ø§Ù„ ÙØ±ÙˆØ´ â€” Ø­Ø¨Ø§Ø¨ Ù…Ø«Ø¨Øª'; else box.innerHTML='âš– Ø®Ù†Ø«ÛŒ';}

function startAutoAPI(){let max=document.getElementById('maxReq').value*1; let interval=(4*60*60)/max; interval*=1000;
autoTimer=setInterval(()=>{fetchAPI(); updateCountdown(interval);}, interval);
alert('Ø¯Ø±ÛŒØ§ÙØª Ø®ÙˆØ¯Ú©Ø§Ø± API ÙØ¹Ø§Ù„ Ø´Ø¯');}
function stopAutoAPI(){clearInterval(autoTimer); alert('Ù…ØªÙˆÙ‚Ù Ø´Ø¯');}
function updateCountdown(i){let sec=i/1000; document.getElementById('countdown').innerHTML='Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ø¹Ø¯ÛŒ: '+Math.floor(sec/60)+' Ø¯Ù‚ÛŒÙ‚Ù‡ '+Math.floor(sec%60)+' Ø«Ø§Ù†ÛŒÙ‡';}
</script>
</body></html>
