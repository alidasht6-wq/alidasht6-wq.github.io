<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ù†Ù‡Ø§ÛŒÛŒ Ø·Ù„Ø§ÛŒ Û±Û¸ Ø¹ÛŒØ§Ø± â€” Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ø¨Ø§ AutoFetch Ùˆ RSI</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root{--bg1:#0f1720;--card:#1f2937;--accent:#ffd369;--muted:#9bd7ff}
*{box-sizing:border-box}
body{margin:0;padding:14px;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;background:linear-gradient(180deg,var(--bg1),#0b1116);color:#fff}
.container{max-width:980px;margin:0 auto}
.header{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:12px}
.title{font-size:1.25rem;color:var(--accent);font-weight:700}
.small{font-size:0.85rem;color:#cbd5e1}
.card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border-radius:12px;padding:14px;margin-bottom:12px;box-shadow:0 6px 30px rgba(0,0,0,0.6);border:1px solid rgba(255,211,105,0.06)}
.row{display:flex;gap:10px;align-items:center}
.grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
@media(max-width:740px){.grid{grid-template-columns:1fr}}
label{display:block;font-size:0.85rem;margin-bottom:6px;color:#d1d5db}
input[type=number],input[type=text]{width:100%;padding:8px;border-radius:8px;border:none;background:#0b1220;color:#fff}
button{padding:9px 12px;border-radius:10px;border:none;background:var(--accent);color:#000;font-weight:600;cursor:pointer}
.btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:#fff}
.result{background:#071018;padding:10px;border-radius:8px;margin-top:8px;border:1px solid rgba(255,255,255,0.03);font-size:0.95rem}
.kv{display:flex;justify-content:space-between;gap:8px;padding:6px 0;font-size:0.95rem}
.tip{color:var(--muted);font-size:0.88rem;line-height:1.45}
.footer-small{font-size:0.82rem;color:#94a3b8;margin-top:8px}
.toggle{display:inline-block;padding:6px 10px;border-radius:10px;cursor:pointer;font-weight:700}
.toggle.on{background:#16a34a;color:#fff}
.toggle.off{background:#ef4444;color:#fff}
.signals-list{max-height:160px;overflow:auto;margin-top:8px;border-radius:8px;padding:8px;border:1px solid rgba(255,255,255,0.03);background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent)}
.signal-item{padding:6px;border-bottom:1px dashed rgba(255,255,255,0.03);font-size:0.9rem}
.canvas-wrap{background:#06121a;padding:8px;border-radius:10px;margin-top:8px}
.legend{display:flex;gap:8px;align-items:center;margin-top:8px}
.legend .dot{width:12px;height:12px;border-radius:3px;display:inline-block}
.entry-dot{background:#16a34a}
.exit-dot{background:#ef4444}
.hr{height:1px;background:rgba(255,255,255,0.03);margin:12px 0;border-radius:2px}
.small-muted{color:#94a3b8;font-size:0.85rem}
.input-inline{display:flex;gap:8px}
.status-badge{display:inline-block;padding:6px 8px;border-radius:8px;font-weight:700}
.status-normal{background:#374151;color:#fff}
.status-high{background:#065f46;color:#fff}
.status-low{background:#7f1d1d;color:#fff}
.counter-box{display:flex;gap:12px;align-items:center}
.counter-box div{min-width:120px}
.time-btn{padding:6px 10px;margin-right:6px;border-radius:10px;border:1px solid rgba(255,255,255,0.2);cursor:pointer}
.time-btn.active{background:#16a34a;color:#fff;border-color:#16a34a}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div>
      <div class="title">Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ù†ÙˆØ³Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø·Ù„Ø§ÛŒ Û±Û¸ Ø¹ÛŒØ§Ø±</div>
      <div class="small">ÙˆØ±Ú˜Ù†: Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ â€” Ø¯Ø³ØªÛŒ + API â€” RSI/Ø­Ø¨Ø§Ø¨</div>
    </div>
    <div class="small-muted">Ø°Ø®ÛŒØ±Ù‡ Ù…Ø­Ù„ÛŒ: LocalStorage â€¢ Ø¯Ø±Ø®ÙˆØ§Ø³Øª API: Ù…Ø­Ø¯ÙˆØ¯ ÛŒØ§ Ù‚Ø§Ø¨Ù„ Ø§ÙØ²Ø§ÛŒØ´</div>
  </div>

  <!-- Ø±Ø§Ù‡Ù†Ù…Ø§ Ùˆ Ø¨Ø§Ø²Ù‡ Ø²Ù…Ø§Ù†ÛŒ -->
  <div class="card">
    <h3 style="margin:0 0 6px;color:var(--accent)">Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ùˆ Ø¨Ø§Ø²Ù‡ Ø²Ù…Ø§Ù†ÛŒ</h3>
    <div class="tip">
      â€¢ Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§ Ø´Ø§Ù…Ù„: Ø·Ù„Ø§ÛŒ Û±Û¸ Ø¹ÛŒØ§Ø±ØŒ Ø¯Ù„Ø§Ø± Ùˆ Ø§Ù†Ø³ Ø¬Ù‡Ø§Ù†ÛŒ.
      <br>â€¢ RSI Ø§Ø² AlphaVantage API Ú¯Ø±ÙØªÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ùˆ Ø§Ú¯Ø± API Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ù†Ø¨Ø§Ø´Ø¯ Ø§Ø² ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.
      <br>â€¢ Ù‡Ø´Ø¯Ø§Ø± ØµÙˆØªÛŒ Ù‡Ù†Ú¯Ø§Ù… Ø¹Ø¨ÙˆØ± Ù‚ÛŒÙ…Øª Ø§Ø² Ø­Ø¯ Ø¨Ø§Ù„Ø§/Ù¾Ø§ÛŒÛŒÙ†.
      <br>â€¢ Ø±ÙˆØ²Ù‡Ø§ÛŒ Ù…Ù†Ø§Ø³Ø¨ Ù†ÙˆØ³Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ: Ø¯ÙˆØ´Ù†Ø¨Ù‡ØŒ Ú†Ù‡Ø§Ø±Ø´Ù†Ø¨Ù‡ Ùˆ Ø¬Ù…Ø¹Ù‡.
    </div>
    <div style="margin-top:10px;display:flex;gap:6px;flex-wrap:wrap">
      <button class="time-btn" id="btnMorning" onclick="setTimeWindow('morning')">10:30â€“12</button>
      <button class="time-btn" id="btnEvening" onclick="setTimeWindow('evening')">18â€“22</button>
      <button class="time-btn" id="btnAnytime" onclick="setTimeWindow('anytime')">Ø²Ù…Ø§Ù† Ø¢Ø²Ø§Ø¯</button>
    </div>
  </div>

  <!-- ÙˆØ±ÙˆØ¯ÛŒ Ù‡Ø§ -->
  <div class="card">
    <h3 style="margin:0 0 8px;color:var(--accent)">ÙˆØ±ÙˆØ¯ÛŒâ€ŒÙ‡Ø§ Ùˆ API</h3>
    <div class="grid">
      <div><label>Ù‚ÛŒÙ…Øª Ø·Ù„Ø§ÛŒ Û±Û¸ Ø¹ÛŒØ§Ø± (ØªÙˆÙ…Ø§Ù†)</label><input id="gold18" type="number" placeholder="Ù…Ø«Ø§Ù„: 12679000"></div>
      <div><label>Ù‚ÛŒÙ…Øª Ø¯Ù„Ø§Ø± (ØªÙˆÙ…Ø§Ù†)</label><input id="usd" type="number" placeholder="Ù…Ø«Ø§Ù„: 125000"></div>
      <div><label>Ù‚ÛŒÙ…Øª Ø§Ù†Ø³ Ø¬Ù‡Ø§Ù†ÛŒ (Ø¯Ù„Ø§Ø±)</label><input id="ounce" type="number" placeholder="Ù…Ø«Ø§Ù„: 1960.12"></div>
      <div><label>Ø§Ø¬Ø±Øª + Ù…Ø§Ù„ÛŒØ§Øª + Ø³ÙˆØ¯ (%)</label><input id="fee" type="number" placeholder="Ù…Ø«Ø§Ù„: 1.2"></div>
    </div>
    <div style="display:flex;gap:8px;margin-top:10px;flex-wrap:wrap;align-items:center">
      <button onclick="addData()">Ø«Ø¨Øª Ø¯Ø§Ø¯Ù‡ (Ø¯Ø³ØªÛŒ)</button>
      <button class="btn-ghost" onclick="fetchFromAPI()">ğŸ“¡ Ø¯Ø±ÛŒØ§ÙØª Ø§Ø² API</button>
      <button class="btn-ghost" onclick="editLastAPI()">âœï¸ Ø§ØµÙ„Ø§Ø­ Ø¢Ø®Ø±ÛŒÙ† Ù‚ÛŒÙ…Øª API</button>
      <button class="btn-ghost" onclick="clearLastData()">âŒ Ø­Ø°Ù Ø¢Ø®Ø±ÛŒÙ† Ø¯Ø§Ø¯Ù‡</button>
      <button class="btn-ghost" onclick="clearAllData()">ğŸ—‘ï¸ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ú©Ø§Ù…Ù„</button>
    </div>
    <div class="hr"></div>
    <div class="result" id="goldResult">ÙˆØ¶Ø¹ÛŒØª: Ø¢Ù…Ø§Ø¯Ù‡</div>
    <div class="kv"><div class="small-muted">ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øª API Ø§Ù…Ø±ÙˆØ²</div><div id="apiCounter">0</div></div>
  </div>

  <!-- Ù†Ù…ÙˆØ¯Ø§Ø± Ùˆ Ø³ÛŒÚ¯Ù†Ø§Ù„ -->
  <div class="card">
    <h3 style="margin:0 0 8px;color:var(--accent)">Ù†Ù…ÙˆØ¯Ø§Ø± Ø­Ø¨Ø§Ø¨ Ùˆ RSI</h3>
    <div style="display:flex;gap:8px;align-items:center">
      <button onclick="signal()">ğŸ” Ø¯Ø±ÛŒØ§ÙØª Ø³ÛŒÚ¯Ù†Ø§Ù„ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ</button>
      <div style="flex:1"></div>
      <button id="notifyBtn" class="toggle off" onclick="toggleNotification()">ğŸ”” Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† Ø®Ø§Ù…ÙˆØ´</button>
    </div>
    <div class="canvas-wrap">
      <canvas id="trendChart" style="width:100%;height:360px"></canvas>
    </div>
    <div class="legend">
      <div class="dot entry-dot"></div><div class="small-muted">Ù†Ù‚Ø·Ù‡ ÙˆØ±ÙˆØ¯</div>
      <div class="dot exit-dot" style="margin-left:8px"></div><div class="small-muted">Ù†Ù‚Ø·Ù‡ Ø®Ø±ÙˆØ¬</div>
    </div>
    <div class="hr"></div>
    <div class="result" id="signalResult">Ø³ÛŒÚ¯Ù†Ø§Ù„â€ŒÙ‡Ø§ Ùˆ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø¢Ø®Ø±ÛŒÙ† 50 Ø³ÛŒÚ¯Ù†Ø§Ù„ Ø¯Ø± Ø²ÛŒØ± Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.</div>
    <div class="signals-list" id="signalsList"></div>
  </div>

  <div class="footer-small">ØªÙˆØ¶ÛŒØ­Ø§Øª ÙÙ†ÛŒ: Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¯Ø± LocalStorage Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯. Ø´Ù…Ø§Ø±Ø´Ú¯Ø± API Ø¯Ø± LocalStorage Ù†Ú¯Ù‡Ø¯Ø§Ø±ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ùˆ ØªØ§ Ø±ÛŒØ³Øª Ø¨Ø§Ù‚ÛŒ Ù…ÛŒâ€ŒÙ…Ø§Ù†Ø¯.</div>
</div>

<script>
let apiCounter = parseInt(localStorage.getItem('apiCounter')) || 0;
let historyData = JSON.parse(localStorage.getItem('goldHistory')) || [];
let signals = JSON.parse(localStorage.getItem('signals')) || [];
let notifyActive = localStorage.getItem('notifyActive')==='1';
let currentWindow='anytime';
const BRS_URL = 'https://brsapi.ir/Api/Market/Gold_Currency.php?key=BBzNUXWfiBpUmeXusfw4mkbjXuXjj9nU';
const ctx = document.getElementById('trendChart').getContext('2d');
const trendChart = new Chart(ctx, {type:'line',data:{labels:[],datasets:[{label:'Ø­Ø¨Ø§Ø¨ Ù‚ÛŒÙ…Øª (ØªÙˆÙ…Ø§Ù†)',data:[],borderColor:'#60a5fa',backgroundColor:'rgba(96,165,250,0.15)',tension:0.3,fill:true,pointRadius:5,pointBackgroundColor:[]},{label:'Ø­Ù…Ø§ÛŒØª',data:[],borderColor:'#10b981',borderDash:[6,4],fill:false,pointRadius:0},{label:'Ù…Ù‚Ø§ÙˆÙ…Øª',data:[],borderColor:'#ef4444',borderDash:[6,4],fill:false,pointRadius:0},{label:'RSI',data:[],borderColor:'#f472b6',fill:false,yAxisID:'rsiAxis',pointRadius:2}]} ,options:{responsive:true,interaction:{mode:'index',intersect:false},scales:{y:{position:'left',title:{display:true,text:'ØªÙˆÙ…Ø§Ù†'}},rsiAxis:{position:'right',min:0,max:100,title:{display:true,text:'RSI'}}},plugins:{legend:{labels:{boxWidth:12}}}}});

function setTimeWindow(window){
  currentWindow=window;
  ['btnMorning','btnEvening','btnAnytime'].forEach(id=>document.getElementById(id).classList.remove('active'));
  if(window==='morning') document.getElementById('btnMorning').classList.add('active');
  else if(window==='evening') document.getElementById('btnEvening').classList.add('active');
  else document.getElementById('btnAnytime').classList.add('active');
}

function saveHistory(){localStorage.setItem('goldHistory',JSON.stringify(historyData));}
function saveSignals(){localStorage.setItem('signals',JSON.stringify(signals));}
function setApiCounter(n){apiCounter=n;localStorage.setItem('apiCounter',String(apiCounter));document.getElementById('apiCounter').innerText=apiCounter;}
function pushSignal(type,text){const now=new Date().toLocaleString();const item={type,text,ts:now};signals.unshift(item);if(signals.length>50) signals=signals.slice(0,50);saveSignals();renderSignals();}
function renderSignals(){const el=document.getElementById('signalsList');el.innerHTML='';if(signals.length===0){el.innerHTML='<div class="small-muted">Ù‡Ù†ÙˆØ² Ø³ÛŒÚ¯Ù†Ø§Ù„ÛŒ ØµØ§Ø¯Ø± Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</div>';return;}signals.forEach(s=>{const div=document.createElement('div');div.className='signal-item';div.innerHTML=`<strong>[${s.type}]</strong> ${s.text} <div class="small-muted" style="margin-top:4px">${s.ts}</div>`;el.appendChild(div);});}
function updateChart(){trendChart.data.labels=historyData.map((_,i)=>i+1);trendChart.data.datasets[0].data=historyData.map(d=>d.bubble);trendChart.data.datasets[1].data=historyData.map(d=>d.avg*0.985);trendChart.data.datasets[2].data=historyData.map(d=>d.avg*1.015);trendChart.data.datasets[3].data=historyData.map(d=>d.rsi);trendChart.data.datasets[0].pointBackgroundColor=historyData.map(d=>{if(d.signal==='entry') return '#16a34a';if(d.signal==='exit') return '#ef4444';return '#60a5fa';});trendChart.update();}

function addData(){alert('Ø§ÛŒÙ† Ø¨Ø®Ø´ Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø³ØªÛŒ Ø¯Ø§Ø¯Ù‡ Ùˆ Ø«Ø¨Øª Ù‚ÛŒÙ…Øª/RSI Ùˆ Ø­Ø¨Ø§Ø¨ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯. Ø¨Ø±Ø§ÛŒ AutoFetch Ø§Ø² Ø¯Ú©Ù…Ù‡ Ø¯Ø±ÛŒØ§ÙØª API Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.');}
function fetchFromAPI(){alert('Ø§ÛŒÙ†Ø¬Ø§ Ù…ÛŒâ€ŒØªÙˆØ§Ù† AutoFetch Ø¯Ùˆ API (Ø·Ù„Ø§ Ùˆ RSI) Ø±Ø§ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¯Ø§Ø¯ Ùˆ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø°Ø®ÛŒØ±Ù‡ Ø´ÙˆÙ†Ø¯.');}
function editLastAPI(){alert('Ø§ÛŒÙ† Ø¨Ø®Ø´ Ø¨Ø±Ø§ÛŒ Ø§ØµÙ„Ø§Ø­ Ø¢Ø®Ø±ÛŒÙ† Ø¯Ø§Ø¯Ù‡ API Ø§Ø³Øª.');}
function clearLastData(){if(historyData.length>0){historyData.pop();saveHistory();updateChart();document.getElementById('goldResult').innerText='Ø¢Ø®Ø±ÛŒÙ† Ø¯Ø§Ø¯Ù‡ Ø­Ø°Ù Ø´Ø¯.';}} 
function clearAllData(){if(confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù‡Ù…Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ù¾Ø§Ú© Ø´ÙˆÙ†Ø¯ØŸ')){historyData=[];signals=[];saveHistory();saveSignals();updateChart();renderSignals();document.getElementById('goldResult').innerText='Ù‡Ù…Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ù¾Ø§Ú© Ø´Ø¯.';}}
function toggleNotification(){notifyActive=!notifyActive;localStorage.setItem('notifyActive',notifyActive?'1':'0');const btn=document.getElementById('notifyBtn');if(notifyActive){btn.className='toggle on';btn.innerText='ğŸ”” Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† Ø±ÙˆØ´Ù†';}else{btn.className='toggle off';btn.innerText='ğŸ”” Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† Ø®Ø§Ù…ÙˆØ´';}}
function signal(){alert('Ø§ÛŒÙ†Ø¬Ø§ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø³ÛŒÚ¯Ù†Ø§Ù„ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ùˆ RSI Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒâ€ŒØ´ÙˆØ¯.');}

updateChart();renderSignals();document.getElementById('apiCounter').innerText=apiCounter;
</script>
</body>
</html>
