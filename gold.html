<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ù†ÙˆØ³Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø·Ù„Ø§ÛŒ Û±Û¸ Ø¹ÛŒØ§Ø±</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body{font-family:sans-serif;background:linear-gradient(135deg,#1b1b1b,#3a3a3a);color:#fff;margin:0;padding:10px}
.container{max-width:700px;margin:auto;padding:10px}
h1,h2{text-align:center;margin-bottom:10px;color:#ffd369;font-size:1.5rem}
.card{background:#2b2b2b;border-radius:15px;padding:15px;margin-bottom:15px;box-shadow:0 0 15px rgba(255,211,105,0.2)}
label{display:block;margin:6px 0 3px;font-size:0.9rem}
input{width:100%;padding:8px;border-radius:8px;border:none;margin-bottom:8px;font-size:0.9rem}
button{width:100%;padding:10px;background:#ffd369;border:none;border-radius:10px;color:#000;font-size:0.95rem;cursor:pointer;margin-top:5px;transition:0.3s}
button:hover{background:#ffb954}
.result{background:#1f1f1f;padding:10px;border-radius:10px;margin-top:10px;font-size:0.9rem;line-height:1.5;border:1px solid #ffd36944;transition:0.4s}
.tip{color:#9bd7ff;font-size:0.85rem;line-height:1.5;margin-bottom:5px}
canvas{border-radius:10px}
</style>
</head>
<body>
<div class="container">
<h1>Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ù†ÙˆØ³Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø·Ù„Ø§ÛŒ Û±Û¸ Ø¹ÛŒØ§Ø±</h1>

<div class="card">
<h2>ØªÙˆØ¶ÛŒØ­Ø§Øª Ø§Ø³ØªÙØ§Ø¯Ù‡</h2>
<p class="tip">
1. Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù†Ø¯ Ø¯Ø³ØªÛŒ ÙˆØ§Ø±Ø¯ Ø´ÙˆÙ†Ø¯ ÛŒØ§ Ø¨Ø§ **Ø¯Ú©Ù…Ù‡ "Ø¯Ø±ÛŒØ§ÙØª Ø§Ø² API"** Ø¢Ù¾Ø¯ÛŒØª Ø´ÙˆÙ†Ø¯.<br>
2. Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø­Ø¨Ø§Ø¨ØŒ Ø­Ù…Ø§ÛŒØª Ùˆ Ù…Ù‚Ø§ÙˆÙ…Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒâ€ŒØ´ÙˆØ¯.<br>
3. Ø³ÛŒÚ¯Ù†Ø§Ù„ ÙˆØ±ÙˆØ¯: Ø­Ø¨Ø§Ø¨ Ù…Ù†ÙÛŒ + Ù†Ø²Ø¯ÛŒÚ© Ø­Ù…Ø§ÛŒØª<br>
4. Ø³ÛŒÚ¯Ù†Ø§Ù„ Ø®Ø±ÙˆØ¬: Ø­Ø¨Ø§Ø¨ Ù…Ø«Ø¨Øª + Ù†Ø²Ø¯ÛŒÚ© Ù…Ù‚Ø§ÙˆÙ…Øª<br>
5. Ø¨Ù‡ØªØ±ÛŒÙ† Ø³Ø§Ø¹Ø§Øª Ù†ÙˆØ³Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ: <strong>10:30 ØªØ§ 12:00 Ø¸Ù‡Ø± Ùˆ 18:00 ØªØ§ 22:00 Ø´Ø¨</strong><br>
6. Ø¨Ø§Ø²Ø§Ø± Ø¬Ù‡Ø§Ù†ÛŒ (Ø§Ù†Ø³ Ø·Ù„Ø§ Ùˆ Ø¯Ù„Ø§Ø±) ØªØ§Ø«ÛŒØ± Ù…Ø³ØªÙ‚ÛŒÙ… Ø¨Ø± Ø¨Ø§Ø²Ø§Ø± Ø§ÛŒØ±Ø§Ù† Ø¯Ø§Ø±Ø¯Ø› Ø¨Ø±Ø§ÛŒ ØªØ­Ù„ÛŒÙ„ Ø¨Ù‡ØªØ± Ù‡Ù…Ø²Ù…Ø§Ù† Ø¨Ø§ Ø¨Ø§Ø²Ø§Ø± Ø¬Ù‡Ø§Ù†ÛŒ Ø¨Ø±Ø±Ø³ÛŒ Ø´ÙˆØ¯.
</p>
</div>

<div class="card">
<h2>Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø§Ø¯Ù‡ Ø§Ø² API / ÙˆØ§Ø±Ø¯ Ú©Ø±Ø¯Ù† Ø¯Ø³ØªÛŒ</h2>
<button onclick="fetchFromAPI()">ğŸ“¡ Ø¯Ø±ÛŒØ§ÙØª Ù‚ÛŒÙ…Øª Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ Ø§Ø² API</button>
<label>Ù‚ÛŒÙ…Øª Ø·Ù„Ø§ÛŒ Û±Û¸ Ø¹ÛŒØ§Ø± (ØªÙˆÙ…Ø§Ù†) - Ø¯Ø³ØªÛŒ:</label>
<input type="number" id="gold18" placeholder="Ù…Ø«Ø§Ù„: 12679000">
<label>Ù‚ÛŒÙ…Øª Ø¯Ù„Ø§Ø± (ØªÙˆÙ…Ø§Ù†) - Ø§Ø®ØªÛŒØ§Ø±ÛŒ:</label>
<input type="number" id="usd">
<label>Ù‚ÛŒÙ…Øª Ø§Ù†Ø³ Ø¬Ù‡Ø§Ù†ÛŒ (Ø¯Ù„Ø§Ø±) - Ø§Ø®ØªÛŒØ§Ø±ÛŒ:</label>
<input type="number" id="ounce">
<label>Ø§Ø¬Ø±Øª + Ù…Ø§Ù„ÛŒØ§Øª + Ø³ÙˆØ¯ (Ø¯Ø±ØµØ¯) - Ø§Ø®ØªÛŒØ§Ø±ÛŒ:</label>
<input type="number" id="fee">
<button onclick="addData()">Ø«Ø¨Øª Ø¯Ø§Ø¯Ù‡</button>
<div id="goldResult" class="result"></div>
</div>

<div class="card">
<h2>Ø³ÛŒÚ¯Ù†Ø§Ù„ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ùˆ Ù†Ù…ÙˆØ¯Ø§Ø± Ø­Ø¨Ø§Ø¨</h2>
<label>Ø±ÙˆÙ†Ø¯ Ø¯Ù„Ø§Ø± (Ù…Ø«Ø¨Øª/Ù…Ù†ÙÛŒ):</label>
<input type="text" id="usdTrend">
<label>Ø±ÙˆÙ†Ø¯ Ø§Ù†Ø³ Ø¬Ù‡Ø§Ù†ÛŒ (Ù…Ø«Ø¨Øª/Ù…Ù†ÙÛŒ):</label>
<input type="text" id="ounceTrend">
<button onclick="signal()">Ø¯Ø±ÛŒØ§ÙØª Ø³ÛŒÚ¯Ù†Ø§Ù„ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ</button>
<div id="signalResult" class="result"></div>
<canvas id="trendChart" style="margin-top:10px;width:100%;height:200px;"></canvas>
</div>
</div>

<script>
// Ø®ÙˆØ§Ù†Ø¯Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø§Ø² LocalStorage
let historyData = JSON.parse(localStorage.getItem('goldHistory')) || [];

// Ù†Ù…ÙˆØ¯Ø§Ø±
const ctx = document.getElementById('trendChart').getContext('2d');
let trendChart = new Chart(ctx,{
    type:'line',
    data:{
        labels:[],
        datasets:[
            {label:'Ø­Ø¨Ø§Ø¨ Ù‚ÛŒÙ…Øª',data:[],borderColor:'#4d7bff',backgroundColor:'rgba(77,123,255,0.2)',tension:0.3,fill:true},
            {label:'Ø­Ù…Ø§ÛŒØª',data:[],borderColor:'green',borderDash:[5,5],fill:false},
            {label:'Ù…Ù‚Ø§ÙˆÙ…Øª',data:[],borderColor:'red',borderDash:[5,5],fill:false}
        ]
    },
    options:{responsive:true,scales:{y:{beginAtZero:false}}}
});

// ØªØ§Ø¨Ø¹ Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø§Ø¯Ù‡ Ø§Ø² API
async function fetchFromAPI(){
    const url="https://brsapi.ir/Api/Market/Gold_Currency.php?key=BBzNUXWfiBpUmeXusfw4mkbjXuXjj9nU";
    try{
        let res=await fetch(url);
        let json=await res.json();
        const gold18=json.gold.find(item=>item.symbol==="IR_GOLD_18K").price;
        const ounce=json.gold.find(item=>item.symbol==="XAUUSD").price;
        const usd=json.currency.find(item=>item.symbol==="USD").price;
        document.getElementById('gold18').value=gold18;
        document.getElementById('usd').value=usd;
        document.getElementById('ounce').value=ounce;
        document.getElementById('goldResult').innerHTML="ğŸ“¡ Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§ Ø§Ø² API Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯.";
    }catch(err){
        console.error(err);
        document.getElementById('goldResult').innerHTML="âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø§Ø¯Ù‡ Ø§Ø² API";
    }
}

// Ø§ÙØ²ÙˆØ¯Ù† Ø¯Ø§Ø¯Ù‡ Ùˆ Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± LocalStorage
function addData(){
    const gold=parseFloat(document.getElementById('gold18').value);
    const usd=parseFloat(document.getElementById('usd').value);
    const ounce=parseFloat(document.getElementById('ounce').value);
    const fee=parseFloat(document.getElementById('fee').value)||0;
    if(!gold){document.getElementById('goldResult').innerHTML='Ù„Ø·ÙØ§Ù‹ Ù‚ÛŒÙ…Øª Ø·Ù„Ø§ÛŒ Û±Û¸ Ø¹ÛŒØ§Ø± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.'; return;}
    const finalPrice = gold || ((ounce*usd)/31.1035)*(1+fee/100);
    const averagePrice = computeAverage(historyData, finalPrice);
    const bubble = finalPrice - averagePrice;
    historyData.push({price:finalPrice,avg:averagePrice,bubble:bubble});
    localStorage.setItem('goldHistory', JSON.stringify(historyData));
    updateChart();
    document.getElementById('goldResult').innerHTML=`Ø«Ø¨Øª Ø´Ø¯: <strong>${finalPrice.toLocaleString()} ØªÙˆÙ…Ø§Ù†</strong> | Ø­Ø¨Ø§Ø¨: <strong>${bubble.toLocaleString()} ØªÙˆÙ…Ø§Ù†</strong>`;
}

// Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ûµ Ø±ÙˆØ² Ø§Ø®ÛŒØ±
function computeAverage(data,newPrice){
    const days=5;
    const recent=data.slice(-days).map(d=>d.price);
    recent.push(newPrice);
    const sum=recent.reduce((a,b)=>a+b,0);
    return sum/recent.length;
}

// Ø³ÛŒÚ¯Ù†Ø§Ù„ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ
function signal(){
    if(historyData.length===0){document.getElementById('signalResult').innerHTML='Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡';return;}
    const last=historyData[historyData.length-1];
    const usdT=document.getElementById('usdTrend').value.trim();
    const ounceT=document.getElementById('ounceTrend').value.trim();
    let support=last.avg*0.985;
    let resistance=last.avg*1.015;
    let result='';
    if(last.bubble<-20000 && last.price<=support) result=`ğŸŸ¢ Ø³ÛŒÚ¯Ù†Ø§Ù„ ÙˆØ±ÙˆØ¯ Ù‚ÙˆÛŒ â€” Ù‚ÛŒÙ…Øª Ù†Ø²Ø¯ÛŒÚ© Ø­Ù…Ø§ÛŒØª: ${support.toLocaleString()}`;
    else if(last.bubble>20000 && last.price>=resistance) result=`ğŸ”´ Ø³ÛŒÚ¯Ù†Ø§Ù„ Ø®Ø±ÙˆØ¬ Ù‚ÙˆÛŒ â€” Ù‚ÛŒÙ…Øª Ù†Ø²Ø¯ÛŒÚ© Ù…Ù‚Ø§ÙˆÙ…Øª: ${resistance.toLocaleString()}`;
    else {
        if(usdT==='Ù…Ù†ÙÛŒ' && ounceT==='Ù…Ù†ÙÛŒ') result='ğŸŸ¢ Ø³ÛŒÚ¯Ù†Ø§Ù„ Ø®Ø±ÛŒØ¯ â€” Ø¨Ù‡ØªØ±ÛŒÙ† Ø²Ù…Ø§Ù† ÙˆØ±ÙˆØ¯';
        else if(usdT==='Ù…Ø«Ø¨Øª' && ounceT==='Ù…Ø«Ø¨Øª') result='ğŸ”´ Ø³ÛŒÚ¯Ù†Ø§Ù„ ÙØ±ÙˆØ´ â€” Ø¨Ø§Ø²Ø§Ø± Ø¯Ø§Øº Ø§Ø³Øª';
        else result=`âš– Ø¨Ø§Ø²Ø§Ø± Ø®Ù†Ø«ÛŒ â€” Ø­Ø¨Ø§Ø¨: ${last.bubble.toLocaleString()} ØªÙˆÙ…Ø§Ù†`;
    }
    document.getElementById('signalResult').innerHTML=result;
}

// Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†Ù…ÙˆØ¯Ø§Ø±
function updateChart(){
    trendChart.data.labels=historyData.map((_,i)=>i+1);
    trendChart.data.datasets[0].data=historyData.map(d=>d.bubble);
    trendChart.data.datasets[1].data=historyData.map(d=>d.avg*0.985);
    trendChart.data.datasets[2].data=historyData.map(d=>d.avg*1.015);
    trendChart.update();
}

// Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù†Ù…ÙˆØ¯Ø§Ø± Ø§Ø² LocalStorage
updateChart();
</script>
</body>
</html>
