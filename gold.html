<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ù†Ù‡Ø§ÛŒÛŒ Ø·Ù„Ø§ÛŒ Û±Û¸ Ø¹ÛŒØ§Ø± â€” Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root{--bg1:#0f1720;--card:#1f2937;--accent:#ffd369;--muted:#9bd7ff}
*{box-sizing:border-box}
body{margin:0;padding:14px;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;background:linear-gradient(180deg,var(--bg1),#0b1116);color:#fff}
.container{max-width:920px;margin:0 auto}
.header{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:12px}
.title{font-size:1.25rem;color:var(--accent);font-weight:700}
.small{font-size:0.85rem;color:#cbd5e1}
.card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border-radius:12px;padding:14px;margin-bottom:12px;box-shadow:0 6px 30px rgba(0,0,0,0.6);border:1px solid rgba(255,211,105,0.06)}
.row{display:flex;gap:10px;align-items:center}
.grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
@media(max-width:740px){.grid{grid-template-columns:1fr}}
label{display:block;font-size:0.85rem;margin-bottom:6px;color:#d1d5db}
input[type=number],input[type=text]{width:100%;padding:8px;border-radius:8px;border:none;background:#0b1220;color:#fff}
button{padding:9px 12px;border-radius:10px;border:none;background:var(--accent);color:#000;font-weight:600;cursor:pointer}
.btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:#fff}
.result{background:#071018;padding:10px;border-radius:8px;margin-top:8px;border:1px solid rgba(255,255,255,0.03);font-size:0.95rem}
.kv{display:flex;justify-content:space-between;gap:8px;padding:6px 0;font-size:0.95rem}
.tip{color:var(--muted);font-size:0.88rem;line-height:1.45}
.footer-small{font-size:0.82rem;color:#94a3b8;margin-top:8px}
.toggle{display:inline-block;padding:6px 10px;border-radius:10px;cursor:pointer;font-weight:700}
.toggle.on{background:#16a34a;color:#fff}
.toggle.off{background:#ef4444;color:#fff}
.signals-list{max-height:160px;overflow:auto;margin-top:8px;border-radius:8px;padding:8px;border:1px solid rgba(255,255,255,0.03);background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent)}
.signal-item{padding:6px;border-bottom:1px dashed rgba(255,255,255,0.03);font-size:0.9rem}
.canvas-wrap{background:#06121a;padding:8px;border-radius:10px;margin-top:8px}
.legend{display:flex;gap:8px;align-items:center;margin-top:8px}
.legend .dot{width:12px;height:12px;border-radius:3px;display:inline-block}
.entry-dot{background:#16a34a}
.exit-dot{background:#ef4444}
.hr{height:1px;background:rgba(255,255,255,0.03);margin:12px 0;border-radius:2px}
.small-muted{color:#94a3b8;font-size:0.85rem}
.input-inline{display:flex;gap:8px}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div>
      <div class="title">Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ù†Ù‡Ø§ÛŒÛŒ Ù†ÙˆØ³Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ â€” Ø·Ù„Ø§ÛŒ Û±Û¸ Ø¹ÛŒØ§Ø±</div>
      <div class="small">ÙˆØ±Ú˜Ù†: Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ â€” Ø¯Ø³ØªÛŒ + API â€” RSI Ø§Ø² API/ØªØ§Ø±ÛŒØ®Ú†Ù‡</div>
    </div>
    <div class="small-muted">Ø¨Ù‡â€ŒØ±ÙˆØ² Ø¯Ø± Ù…Ø±ÙˆØ±Ú¯Ø±Øª Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ â€¢ Ù…Ø­Ø¯ÙˆØ¯ÛŒØª API: 100/Ø±ÙˆØ²</div>
  </div>

  <!-- ØªÙˆØ¶ÛŒØ­Ø§Øª Ùˆ ØªØ§ÛŒÙ… -->
  <div class="card">
    <div style="display:flex;justify-content:space-between;gap:10px;align-items:flex-start">
      <div style="flex:1">
        <h3 style="margin:0 0 6px;color:var(--accent)">Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø³Ø±ÛŒØ¹ Ø§Ø³ØªÙØ§Ø¯Ù‡</h3>
        <div class="tip">
          â€¢ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§ Ø±Ø§ <strong>Ø¯Ø³ØªÛŒ</strong> ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ ÛŒØ§ Ø§Ø² Ø¯Ú©Ù…Ù‡Ù” <strong>Ø¯Ø±ÛŒØ§ÙØª Ø§Ø² API</strong> Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.<br>
          â€¢ Ø§Ú¯Ø± Ú©Ù„ÛŒØ¯ RSI API (Ø¯Ø± Ø§Ø¯Ø§Ù…Ù‡) Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ØŒ Ø¨Ø±Ù†Ø§Ù…Ù‡ ØªÙ„Ø§Ø´ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ RSI ÙˆØ§Ù‚Ø¹ÛŒ (Ø§Ø² Ø³Ø±ÙˆÛŒØ³ Ø®Ø§Ø±Ø¬ÛŒ) Ø±Ø§ Ø¯Ø±ÛŒØ§ÙØª Ú©Ù†Ø¯Ø› Ø¯Ø± ØºÛŒØ± Ø§ÛŒÙ† ØµÙˆØ±Øª RSI Ø§Ø² ØªØ§Ø±ÛŒØ®Ú†Ù‡Ù” Ø°Ø®ÛŒØ±Ù‡â€ŒØ´Ø¯Ù‡ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.<br>
          â€¢ Ø³ÛŒÚ¯Ù†Ø§Ù„ ÙˆØ±ÙˆØ¯: <strong>Ø­Ø¨Ø§Ø¨ Ù…Ù†ÙÛŒ + Ù†Ø²Ø¯ÛŒÚ©ÛŒ Ø¨Ù‡ Ø­Ù…Ø§ÛŒØª</strong> â€” Ø³ÛŒÚ¯Ù†Ø§Ù„ Ø®Ø±ÙˆØ¬: <strong>Ø­Ø¨Ø§Ø¨ Ù…Ø«Ø¨Øª + Ù†Ø²Ø¯ÛŒÚ©ÛŒ Ø¨Ù‡ Ù…Ù‚Ø§ÙˆÙ…Øª</strong>.<br>
          â€¢ Ø¨Ù‡ØªØ±ÛŒÙ† Ø³Ø§Ø¹Ø§Øª Ù†ÙˆØ³Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ: <strong>10:30â€“12:00 Ø¸Ù‡Ø±</strong> Ùˆ <strong>18:00â€“22:00 Ø´Ø¨</strong> (Ø§ÛŒØ±Ø§Ù†).<br>
          â€¢ Ø§Ú¯Ø± Ù‚ÛŒÙ…Øª Ø¢Ø®Ø±ÛŒÙ† API Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³ØªØŒ Ø¨Ø§ Ø¯Ú©Ù…Ù‡Ù” Â«Ø§ØµÙ„Ø§Ø­ Ø¢Ø®Ø±ÛŒÙ† Ù‚ÛŒÙ…Øª APIÂ» Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ù…Ù‚Ø¯Ø§Ø± Ø±Ø§ ØªØµØ­ÛŒØ­ Ú©Ù†ÛŒØ¯ (Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡ Ø¯Ø± LocalStorage).
        </div>
      </div>
      <div style="width:260px">
        <div class="kv"><div class="small-muted">ØªØ§ÛŒÙ… ØªØ±ÛŒØ¯ ØµØ¨Ø­</div><div>10:30 â€” 12:00</div></div>
        <div class="kv"><div class="small-muted">ØªØ§ÛŒÙ… ØªØ±ÛŒØ¯ Ø´Ø¨</div><div>18:00 â€” 22:00</div></div>
        <div class="hr"></div>
        <div class="small-muted">Ù†Ú©ØªÙ‡: Ø¨Ø±Ø±Ø³ÛŒ Ù‡Ù…Ø²Ù…Ø§Ù† Ø§Ù†Ø³ Ùˆ Ø¯Ù„Ø§Ø± Ø¬Ù‡Ø§Ù†ÛŒØŒ Ø§Ø¹ØªØ¨Ø§Ø± Ø³ÛŒÚ¯Ù†Ø§Ù„ Ø±Ø§ Ø¨Ø§Ù„Ø§ Ù…ÛŒâ€ŒØ¨Ø±Ø¯.</div>
      </div>
    </div>
  </div>

  <!-- ÙˆØ±ÙˆØ¯ÛŒ Ù‡Ø§ -->
  <div class="card">
    <h3 style="margin:0 0 8px;color:var(--accent)">ÙˆØ±ÙˆØ¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù‚ÛŒÙ…Øª (Ø¯Ø³ØªÛŒ ÛŒØ§ API)</h3>
    <div class="grid">
      <div>
        <label>Ù‚ÛŒÙ…Øª Ø·Ù„Ø§ÛŒ Û±Û¸ Ø¹ÛŒØ§Ø± (ØªÙˆÙ…Ø§Ù†)</label>
        <input id="gold18" type="number" placeholder="Ù…Ø«Ø§Ù„: 12679000">
      </div>
      <div>
        <label>Ù‚ÛŒÙ…Øª Ø¯Ù„Ø§Ø± (ØªÙˆÙ…Ø§Ù†)</label>
        <input id="usd" type="number" placeholder="Ù…Ø«Ø§Ù„: 125000">
      </div>
      <div>
        <label>Ù‚ÛŒÙ…Øª Ø§Ù†Ø³ Ø¬Ù‡Ø§Ù†ÛŒ (Ø¯Ù„Ø§Ø±)</label>
        <input id="ounce" type="number" placeholder="Ù…Ø«Ø§Ù„: 1960.12">
      </div>
      <div>
        <label>Ø§Ø¬Ø±Øª + Ù…Ø§Ù„ÛŒØ§Øª + Ø³ÙˆØ¯ (%)</label>
        <input id="fee" type="number" placeholder="Ù…Ø«Ø§Ù„: 1.2">
      </div>
    </div>

    <div style="display:flex;gap:8px;margin-top:10px;flex-wrap:wrap">
      <button onclick="addData()">Ø«Ø¨Øª Ø¯Ø§Ø¯Ù‡ (Ø¯Ø³ØªÛŒ)</button>
      <button class="btn-ghost" onclick="fetchFromAPI()">ğŸ“¡ Ø¯Ø±ÛŒØ§ÙØª Ø§Ø² API (BRSAPI)</button>
      <button class="btn-ghost" onclick="editLastAPI()">âœï¸ Ø§ØµÙ„Ø§Ø­ Ø¢Ø®Ø±ÛŒÙ† Ù‚ÛŒÙ…Øª API</button>
      <div style="flex:1"></div>
      <div style="min-width:220px">
        <label>API Ú©Ù„ÛŒØ¯ Ø¨Ø±Ø§ÛŒ RSI (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)</label>
        <div class="input-inline"><input id="rsiApiKey" type="text" placeholder="Ù…Ø«Ø§Ù„: ALPHAVANTAGE_KEY"><button class="btn-ghost" onclick="saveRSIKey()">Ø°Ø®ÛŒØ±Ù‡</button></div>
        <div class="small-muted" style="margin-top:6px">Ø§Ú¯Ø± ÙˆØ§Ø±Ø¯ Ù†Ø´ÙˆØ¯ØŒ RSI Ø§Ø² ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.</div>
      </div>
    </div>

    <div class="hr"></div>
    <div class="result" id="goldResult">ÙˆØ¶Ø¹ÛŒØª: Ø¢Ù…Ø§Ø¯Ù‡</div>
    <div class="kv" style="margin-top:8px"><div class="small-muted">ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øª API Ø§Ù…Ø±ÙˆØ²</div><div id="apiCounter">0</div></div>
  </div>

  <!-- Ù†Ù…ÙˆØ¯Ø§Ø± Ùˆ Ø³ÛŒÚ¯Ù†Ø§Ù„ -->
  <div class="card">
    <h3 style="margin:0 0 8px;color:var(--accent)">Ù†Ù…ÙˆØ¯Ø§Ø± Ø­Ø¨Ø§Ø¨ØŒ Ø­Ù…Ø§ÛŒØª/Ù…Ù‚Ø§ÙˆÙ…Øª Ùˆ RSI</h3>
    <div style="display:flex;gap:8px;align-items:center">
      <button onclick="signal()">ğŸ” Ø¯Ø±ÛŒØ§ÙØª Ø³ÛŒÚ¯Ù†Ø§Ù„ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ</button>
      <div style="flex:1"></div>
      <div>
        <button id="notifyBtn" class="toggle off" onclick="toggleNotification()">ğŸ”” Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† Ø®Ø§Ù…ÙˆØ´</button>
      </div>
    </div>

    <div class="canvas-wrap">
      <canvas id="trendChart" style="width:100%;height:360px"></canvas>
    </div>

    <div class="legend">
      <div class="dot entry-dot"></div><div class="small-muted">Ù†Ù‚Ø·Ù‡ ÙˆØ±ÙˆØ¯</div>
      <div class="dot exit-dot" style="margin-left:8px"></div><div class="small-muted">Ù†Ù‚Ø·Ù‡ Ø®Ø±ÙˆØ¬</div>
    </div>

    <div class="hr"></div>
    <div class="result" id="signalResult">Ø³ÛŒÚ¯Ù†Ø§Ù„â€ŒÙ‡Ø§ Ùˆ ØªØ§Ø±ÛŒØ®Ú†Ù‡Ù” Ø¢Ø®Ø±ÛŒÙ† 10 Ø³ÛŒÚ¯Ù†Ø§Ù„ Ø¯Ø± Ø²ÛŒØ± Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.</div>

    <div class="signals-list" id="signalsList"></div>
  </div>

  <div class="footer-small">ØªÙˆØ¶ÛŒØ­Ø§Øª ÙÙ†ÛŒ: Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¯Ø± LocalStorage Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯. ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øª API Ø¯Ø± LocalStorage Ù†Ú¯Ù‡Ø¯Ø§Ø±ÛŒ Ø´Ø¯Ù‡ Ùˆ ØªØ§ ÙˆÙ‚ØªÛŒ Ù¾Ø§Ú© Ù†Ø´ÙˆØ¯ Ø­ÙØ¸ Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø¯.</div>

</div>

<script>
/* -------------------------
  ØªÙ†Ø¸ÛŒÙ… Ø§ÙˆÙ„ÛŒÙ‡ Ùˆ Ù…ØªØºÛŒØ±Ù‡Ø§
--------------------------*/
const BRS_URL = "https://brsapi.ir/Api/Market/Gold_Currency.php?key=BBzNUXWfiBpUmeXusfw4mkbjXuXjj9nU";
let apiCounter = parseInt(localStorage.getItem('apiCounter')) || 0;
let historyData = JSON.parse(localStorage.getItem('goldHistory')) || []; // Ø¢Ø±Ø§ÛŒÙ‡Ù” Ø¢Ø¨Ø¬Ú©Øª: {price,avg,bubble,rsi,usd,ounce,ts,usdTrend,ounceTrend}
let signals = JSON.parse(localStorage.getItem('signals')) || []; // Ù„ÛŒØ³Øª Ø³ÛŒÚ¯Ù†Ø§Ù„â€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´
let notifyActive = (localStorage.getItem('notifyActive') === '1');
const apiRSIKey = localStorage.getItem('rsiApiKey') || "";

/* Ø§Ù„Ù…Ø§Ù†â€ŒÙ‡Ø§ */
document.getElementById('apiCounter').innerText = apiCounter;
if(notifyActive){document.getElementById('notifyBtn').className='toggle on';document.getElementById('notifyBtn').innerText='ğŸ”” Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† Ø±ÙˆØ´Ù†'} 

/* Chart.js setup */
const ctx = document.getElementById('trendChart').getContext('2d');
const trendChart = new Chart(ctx, {
  type: 'line',
  data: {
    labels: [],
    datasets: [
      { label: 'Ø­Ø¨Ø§Ø¨ Ù‚ÛŒÙ…Øª (ØªÙˆÙ…Ø§Ù†)', data: [], borderColor:'#60a5fa', backgroundColor:'rgba(96,165,250,0.15)', tension:0.3, fill:true, pointRadius:5, pointBackgroundColor:[] },
      { label: 'Ø­Ù…Ø§ÛŒØª', data: [], borderColor:'#10b981', borderDash:[6,4], fill:false, pointRadius:0 },
      { label: 'Ù…Ù‚Ø§ÙˆÙ…Øª', data: [], borderColor:'#ef4444', borderDash:[6,4], fill:false, pointRadius:0 },
      { label: 'RSI', data: [], borderColor:'#f472b6', fill:false, yAxisID: 'rsiAxis', pointRadius:2 }
    ]
  },
  options: {
    responsive:true,
    interaction:{mode:'index',intersect:false},
    scales: {
      y: { position:'left', title:{display:true,text:'ØªÙˆÙ…Ø§Ù† (Ø­Ø¨Ø§Ø¨/Ø³Ø·ÙˆØ­)'} },
      rsiAxis: { position:'right', min:0, max:100, title:{display:true,text:'RSI'} }
    },
    plugins: { legend:{labels:{boxWidth:12}}}
  }
});

/* -------------------------
  ØªÙˆØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ
--------------------------*/
function saveHistory(){
  localStorage.setItem('goldHistory', JSON.stringify(historyData));
}
function saveSignals(){ localStorage.setItem('signals', JSON.stringify(signals)); }
function setApiCounter(n){ apiCounter = n; localStorage.setItem('apiCounter', String(apiCounter)); document.getElementById('apiCounter').innerText = apiCounter; }

/* Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ûµ Ø±ÙˆØ² Ø§Ø®ÛŒØ± (ÛŒØ§ Ú©Ù…ØªØ±) */
function computeAverage(data, newPrice){
  const days = 5;
  const recent = data.slice(-days).map(d=>d.price);
  recent.push(newPrice);
  const sum = recent.reduce((a,b)=>a+b,0);
  return sum / recent.length;
}

/* Ù…Ø­Ø§Ø³Ø¨Ù‡ RSI Ø§Ø² Ø¢Ø±Ø§ÛŒÙ‡Ù” Ù‚ÛŒÙ…Øª (Ø³Ø§Ø¯Ù‡) */
function computeRSI(prices, period=14){
  if(prices.length < period + 1) return 50;
  let gains = 0, losses = 0;
  for(let i = prices.length - period; i < prices.length; i++){
    const diff = prices[i] - prices[i-1];
    if(diff > 0) gains += diff; else losses += Math.abs(diff);
  }
  if(losses === 0) return 100;
  const rs = gains / losses;
  return 100 - (100 / (1 + rs));
}

/* ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ Ú¯Ø±ÙØªÙ† RSI Ø§Ø² API Ø®Ø§Ø±Ø¬ÛŒ (AlphaVantage Ù…Ø«Ø§Ù„) â€” Ù†ÛŒØ§Ø² Ø¨Ù‡ Ú©Ù„ÛŒØ¯ */
async function fetchRSIFromAPI(symbol='XAUUSD', interval='daily', time_period=14){
  const key = localStorage.getItem('rsiApiKey');
  if(!key) return null;
  try{
    // Ù…Ø«Ø§Ù„ Ø¨Ø±Ø§ÛŒ Alpha Vantage: function=RSI&symbol=XXX&interval=daily&time_period=14&series_type=close&apikey=KEY
    // ØªÙˆØ¬Ù‡: Ø¨Ø³ÛŒØ§Ø±ÛŒ Ø§Ø² APIÙ‡Ø§ Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ Ø±Ø§ Ù…ØªÙØ§ÙˆØª Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ù†Ø¯Ø› Ø§ÛŒÙ†Ø¬Ø§ Ø§Ø² Alpha Vantage Ù‚Ø§Ù„Ø¨ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´Ø¯Ù‡ â€” Ø§Ú¯Ø± Ø³Ø±ÙˆÛŒØ³ Ø¯ÛŒÚ¯Ø±ÛŒ Ø¯Ø§Ø±ÛŒØŒ Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒÙ… URL Ø±Ø§ ØªØºÛŒÛŒØ± Ø¯Ù‡ÛŒÙ….
    const url = `https://www.alphavantage.co/query?function=RSI&symbol=${symbol}&interval=${interval}&time_period=${time_period}&series_type=close&apikey=${key}`;
    const res = await fetch(url);
    const j = await res.json();
    if(j['Technical Analysis: RSI']){
      const lastKey = Object.keys(j['Technical Analysis: RSI'])[0];
      const val = parseFloat(j['Technical Analysis: RSI'][lastKey]['RSI']);
      return val;
    }
    return null;
  }catch(e){
    console.error('RSI API error', e);
    return null;
  }
}

/* Ù¾Ø®Ø´ ØµØ¯Ø§ Ùˆ Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† */
function playSound(){ try{ const a = new Audio('https://www.soundjay.com/button/sounds/beep-07.mp3'); a.play(); }catch(e){console.warn(e);} }
function notify(message){
  if(!notifyActive) return;
  if(Notification.permission === 'granted'){ new Notification('Ø³ÛŒÚ¯Ù†Ø§Ù„ Ø·Ù„Ø§ÛŒ Û±Û¸ Ø¹ÛŒØ§Ø±', { body: message }); }
  else if(Notification.permission !== 'denied'){ Notification.requestPermission().then(p => { if(p==='granted') new Notification('Ø³ÛŒÚ¯Ù†Ø§Ù„ Ø·Ù„Ø§ÛŒ Û±Û¸ Ø¹ÛŒØ§Ø±', { body: message }); }); }
}

/* Ø§ÙØ²ÙˆØ¯Ù† Ø³ÛŒÚ¯Ù†Ø§Ù„ Ø¨Ù‡ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ùˆ Ù†Ù…Ø§ÛŒØ´ Ù„ÛŒØ³Øª */
function pushSignal(type, text){
  const now = new Date().toLocaleString();
  const item = {type, text, ts: now};
  signals.unshift(item);
  if(signals.length>50) signals = signals.slice(0,50);
  saveSignals();
  renderSignals();
}

/* Ù†Ù…Ø§ÛŒØ´ Ù„ÛŒØ³Øª Ø³ÛŒÚ¯Ù†Ø§Ù„â€ŒÙ‡Ø§ */
function renderSignals(){
  const el = document.getElementById('signalsList');
  el.innerHTML = '';
  if(signals.length===0){ el.innerHTML = '<div class="small-muted">Ù‡Ù†ÙˆØ² Ø³ÛŒÚ¯Ù†Ø§Ù„ÛŒ ØµØ§Ø¯Ø± Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</div>'; return; }
  signals.forEach(s=>{
    const div = document.createElement('div');
    div.className = 'signal-item';
    div.innerHTML = `<strong>[${s.type}]</strong> ${s.text} <div class="small-muted" style="margin-top:4px">${s.ts}</div>`;
    el.appendChild(div);
  });
}

/* Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†Ù…ÙˆØ¯Ø§Ø± */
function updateChart(){
  trendChart.data.labels = historyData.map((_,i)=>i+1);
  trendChart.data.datasets[0].data = historyData.map(d=>d.bubble);
  trendChart.data.datasets[1].data = historyData.map(d=>d.avg*0.985);
  trendChart.data.datasets[2].data = historyData.map(d=>d.avg*1.015);
  trendChart.data.datasets[3].data = historyData.map(d=>d.rsi);
  // point color: default blue; if entry/exit flagged, color that point
  trendChart.data.datasets[0].pointBackgroundColor = historyData.map(d=>{
    if(d.signal === 'entry') return '#16a34a';
    if(d.signal === 'exit') return '#ef4444';
    return '#60a5fa';
  });
  trendChart.update();
}

/* Ø°Ø®ÛŒØ±Ù‡ Ú©Ù„ÛŒØ¯ RSI */
function saveRSIKey(){
  const key = document.getElementById('rsiApiKey').value.trim();
  if(!key){ alert('Ú©Ù„ÛŒØ¯ ÙˆØ§Ø±Ø¯ Ù†Ø´Ø¯Ù‡'); return; }
  localStorage.setItem('rsiApiKey', key);
  document.getElementById('goldResult').innerText = 'Ú©Ù„ÛŒØ¯ RSI Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯. Ø¯Ø± Ø¯ÙØ¹Ø§Øª Ø¨Ø¹Ø¯ÛŒ ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª RSI Ø§Ø² API Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒâ€ŒØ´ÙˆØ¯.';
}

/* ÙˆÛŒØ±Ø§ÛŒØ´ Ø¢Ø®Ø±ÛŒÙ† Ù‚ÛŒÙ…Øª API (Ø¯Ø± ØµÙˆØ±ØªÛŒ Ú©Ù‡ Ø§Ø´ØªØ¨Ø§Ù‡ Ø¨Ø§Ø´Ø¯) */
function editLastAPI(){
  if(historyData.length===0){ alert('Ù‡Ù†ÙˆØ² Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.'); return; }
  const last = historyData[historyData.length-1];
  const newVal = prompt('Ù‚ÛŒÙ…Øª Ø§ØµÙ„Ø§Ø­â€ŒØ´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø¢Ø®Ø±ÛŒÙ† Ø«Ø¨Øª API Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ (ØªÙˆÙ…Ø§Ù†):', String(last.price));
  if(!newVal) return;
  const n = parseFloat(newVal);
  if(isNaN(n)){ alert('Ù‚ÛŒÙ…Øª Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯'); return; }
  historyData[historyData.length-1].price = n;
  // Ø¨Ø§Ø²Ù…Ø­Ø§Ø³Ø¨Ù‡ avg,bubble,rsi
  const avg = computeAverage(historyData.slice(0,-1), n);
  historyData[historyData.length-1].avg = avg;
  historyData[historyData.length-1].bubble = n - avg;
  const prices = historyData.map(d=>d.price);
  historyData[historyData.length-1].rsi = computeRSI(prices,14);
  saveHistory();
  updateChart();
  document.getElementById('goldResult').innerText = 'Ø¢Ø®Ø±ÛŒÙ† Ù‚ÛŒÙ…Øª API Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§ØµÙ„Ø§Ø­ Ø´Ø¯.';
}

/* -------------------------
  Ø¹Ù…Ù„ÛŒØ§Øª Ø§ØµÙ„ÛŒ: Ø§ÙØ²ÙˆØ¯Ù† Ø¯Ø§Ø¯Ù‡ (Ø¯Ø³ØªÛŒ)
--------------------------*/
async function addData(){
  const gold = parseFloat(document.getElementById('gold18').value);
  const usd = parseFloat(document.getElementById('usd').value) || 0;
  const ounce = parseFloat(document.getElementById('ounce').value) || 0;
  const fee = parseFloat(document.getElementById('fee').value) || 0;
  if(!gold && !(usd && ounce)){
    document.getElementById('goldResult').innerText = 'Ù„Ø·ÙØ§Ù‹ ÛŒØ§ Ù‚ÛŒÙ…Øª Ø·Ù„Ø§ÛŒ Û±Û¸ Ø¹ÛŒØ§Ø± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ ÛŒØ§ Ø¯Ù„Ø§Ø± Ùˆ Ø§Ù†Ø³ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯.';
    return;
  }

  // Ø§Ú¯Ø± Ø·Ù„Ø§ÛŒ 18 Ø¯Ø³ØªÛŒ ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡ØŒ Ø§Ø² Ø¢Ù† Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†Ø› Ø¯Ø± ØºÛŒØ± Ø§ÛŒÙ† ØµÙˆØ±Øª Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø§Ø² Ø§Ù†Ø³ Ùˆ Ø¯Ù„Ø§Ø±
  let finalPrice = gold || ((ounce * usd) / 31.1035) * (1 + fee/100);
  const avg = computeAverage(historyData, finalPrice);
  const bubble = finalPrice - avg;

  // RSI: Ø§Ú¯Ø± Ú©Ù„ÛŒØ¯ RSI Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯ØŒ ØªÙ„Ø§Ø´ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… Ø§Ø² API Ø¨Ú¯ÛŒØ±ÛŒÙ…. Ø¯Ø± ØºÛŒØ± Ø§ÛŒÙ† ØµÙˆØ±Øª Ø§Ø² ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ….
  let rsi = 50;
  const pricesForRSI = [...historyData.map(d=>d.price), finalPrice];
  const rsiKey = localStorage.getItem('rsiApiKey');
  if(rsiKey){
    const fetched = await fetchRSIFromAPI('XAUUSD','daily',14);
    if(fetched !== null){ rsi = fetched; } else { rsi = computeRSI(pricesForRSI,14); }
  } else {
    rsi = computeRSI(pricesForRSI,14);
  }

  // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø±ÙˆÙ†Ø¯ Ø¯Ù„Ø§Ø± Ùˆ Ø§Ù†Ø³ Ù†Ø³Ø¨Øª Ø¨Ù‡ Ø¢Ø®Ø±ÛŒÙ† Ø«Ø¨Øª (Ø§Ú¯Ø± ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯)
  let usdTrend = 'â€”', ounceTrend = 'â€”';
  if(historyData.length>0){
    const last = historyData[historyData.length-1];
    usdTrend = (usd && last.usd) ? (usd > last.usd ? 'Ù…Ø«Ø¨Øª' : (usd < last.usd ? 'Ù…Ù†ÙÛŒ' : 'Ø«Ø§Ø¨Øª')) : last.usdTrend || 'â€”';
    ounceTrend = (ounce && last.ounce) ? (ounce > last.ounce ? 'Ù…Ø«Ø¨Øª' : (ounce < last.ounce ? 'Ù…Ù†ÙÛŒ' : 'Ø«Ø§Ø¨Øª')) : last.ounceTrend || 'â€”';
  }

  // Ø°Ø®ÛŒØ±Ù‡Ù” Ø´ÛŒØ¡ Ø¯Ø§Ø¯Ù‡
  const now = Date.now();
  const obj = { price: finalPrice, avg: avg, bubble: bubble, rsi: rsi, usd: usd, ounce: ounce, fee: fee, ts: now, usdTrend: usdTrend, ounceTrend: ounceTrend };
  historyData.push(obj);
  saveHistory();
  updateChart();
  document.getElementById('goldResult').innerText = `Ø«Ø¨Øª Ø´Ø¯: ${finalPrice.toLocaleString()} ØªÙˆÙ…Ø§Ù† | Ø­Ø¨Ø§Ø¨: ${bubble.toLocaleString()} ØªÙˆÙ…Ø§Ù† | RSI: ${rsi.toFixed(2)}`;
}

/* -------------------------
  Ø¯Ø±ÛŒØ§ÙØª Ø§Ø² BRSAPI (Ùˆ Ø§ÙØ²ÙˆØ¯Ù† Ø®ÙˆØ¯Ú©Ø§Ø±)
--------------------------*/
async function fetchFromAPI(){
  if(apiCounter >= 100){
    document.getElementById('goldResult').innerText = 'âš  Ø³Ù‚Ù 100 Ø¯Ø±Ø®ÙˆØ§Ø³Øª API Ø§Ù…Ø±ÙˆØ² Ø±Ø³ÛŒØ¯!';
    return;
  }
  try{
    const res = await fetch(BRS_URL);
    const j = await res.json();
    // Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ù…Ù‚Ø§Ø¯ÛŒØ± Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯ Ø¯Ø± JSON â€” Ø§Ú¯Ø± Ø³Ø§Ø®ØªØ§Ø± ØªØºÛŒÛŒØ± Ú©Ù†Ø¯ØŒ Ù…Ù…Ú©Ù† Ø§Ø³Øª Ù„Ø§Ø²Ù… Ø¨Ø§Ø´Ø¯ Ø§ÛŒÙ† Ø¨Ø®Ø´ ØªÙ†Ø¸ÛŒÙ… Ø´ÙˆØ¯
    const goldObj = Array.isArray(j.gold) ? j.gold.find(i=>i.symbol==='IR_GOLD_18K') : null;
    const xauObj = Array.isArray(j.gold) ? j.gold.find(i=>i.symbol==='XAUUSD') : null;
    const usdObj = Array.isArray(j.currency) ? j.currency.find(i=>i.symbol==='USD') : null;

    const gold18 = goldObj ? parseFloat(goldObj.price) : null;
    const ounce = xauObj ? parseFloat(xauObj.price) : null;
    const usd = usdObj ? parseFloat(usdObj.price) : null;

    // Ù†Ø´Ø§Ù† Ø¨Ø¯Ù‡ Ø¢Ø®Ø±ÛŒÙ† Ù‚ÛŒÙ…Øª API Ú†Ù‡ Ø¨ÙˆØ¯Ù‡ (Ùˆ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø± Ø§Ø·Ù„Ø§Ø¹ Ø¨Ø¯Ù‡ Ø§Ú¯Ø± Ø§Ø´ØªØ¨Ø§Ù‡ Ø¯ÛŒØ¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯)
    document.getElementById('gold18').value = gold18 || '';
    document.getElementById('usd').value = usd || '';
    document.getElementById('ounce').value = ounce || '';
    setApiCounter(apiCounter + 1);

    // Ø®ÙˆØ¯Ú©Ø§Ø± Ø§ÙØ²ÙˆØ¯Ù† Ø¯Ø§Ø¯Ù‡ (Ø¨Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù…Ù‚Ø¯Ø§Ø± API)
    // Ø§Ú¯Ø± gold18 ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø´ØªØŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø§Ù†Ø³ Ùˆ Ø¯Ù„Ø§Ø±
    if(!gold18 && usd && ounce){
      document.getElementById('goldResult').innerText = 'Ù‚ÛŒÙ…Øª Ø·Ù„Ø§ÛŒ Û±Û¸ Ø§Ø² API Ù…ÙˆØ¬ÙˆØ¯ Ù†Ø¨ÙˆØ¯ â€” Ø¯Ø± ØµÙˆØ±Øª ÙˆØ¬ÙˆØ¯ Ø§Ù†Ø³ Ùˆ Ø¯Ù„Ø§Ø±ØŒ Ù‚ÛŒÙ…Øª Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.';
    } else {
      document.getElementById('goldResult').innerText = `Ø¢Ø®Ø±ÛŒÙ† Ù‚ÛŒÙ…Øª API: ${gold18 ? gold18.toLocaleString() + ' ØªÙˆÙ…Ø§Ù†' : 'Ù†Ø§Ù…Ø´Ø®Øµ'} (Ø§Ú¯Ø± Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª Ø§Ø² Ø¯Ú©Ù…Ù‡ Ø§ØµÙ„Ø§Ø­ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯)`;
    }

    // Ø­Ø§Ù„Ø§ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù† (Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ gold Ø¯Ø³ØªÛŒ ÛŒØ§ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯)
    document.getElementById('goldResult').innerText += ' â€” Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ù‡ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯...';
    await addData(); // ØªÙˆØ¬Ù‡: addData Ø§Ø² ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ ÙˆØ±ÙˆØ¯ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ (Ú©Ù‡ Ù…Ø§ Ù¾Ø± Ú©Ø±Ø¯ÛŒÙ…)
    // Ø¯Ø±Ø¬ Ø³ÛŒÚ¯Ù†Ø§Ù„ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¯Ø± ØµÙˆØ±ØªÛŒ Ú©Ù‡ Ø´Ø±Ø§ÛŒØ· Ø¨Ø±Ù‚Ø±Ø§Ø± Ø¨Ø§Ø´Ø¯:
    autoSignalCheck();
  }catch(err){
    console.error(err);
    document.getElementById('goldResult').innerText = 'âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø§Ø¯Ù‡ Ø§Ø² API';
  }
}

/* -------------------------
  ØªÙˆÙ„ÛŒØ¯ Ø³ÛŒÚ¯Ù†Ø§Ù„ Ùˆ Ø¹Ù„Ø§Ù…Øª Ú¯Ø°Ø§Ø±ÛŒ Ø±ÙˆÛŒ Ù†Ù…ÙˆØ¯Ø§Ø±
--------------------------*/
function autoSignalCheck(){
  if(historyData.length===0) return;
  const last = historyData[historyData.length-1];
  const support = last.avg * 0.985;
  const resistance = last.avg * 1.015;
  let txt = '';
  if(last.bubble < -20000 && last.price <= support){
    txt = `ğŸŸ¢ Ø³ÛŒÚ¯Ù†Ø§Ù„ ÙˆØ±ÙˆØ¯ Ù‚ÙˆÛŒ â€” Ù‚ÛŒÙ…Øª Ù†Ø²Ø¯ÛŒÚ© Ø­Ù…Ø§ÛŒØª: ${support.toLocaleString()}`;
    pushSignal('ÙˆØ±ÙˆØ¯', txt);
    playSound(); notify(txt);
    historyData[historyData.length-1].signal = 'entry';
  } else if(last.bubble > 20000 && last.price >= resistance){
    txt = `ğŸ”´ Ø³ÛŒÚ¯Ù†Ø§Ù„ Ø®Ø±ÙˆØ¬ Ù‚ÙˆÛŒ â€” Ù‚ÛŒÙ…Øª Ù†Ø²Ø¯ÛŒÚ© Ù…Ù‚Ø§ÙˆÙ…Øª: ${resistance.toLocaleString()}`;
    pushSignal('Ø®Ø±ÙˆØ¬', txt);
    playSound(); notify(txt);
    historyData[historyData.length-1].signal = 'exit';
  } else {
    historyData[historyData.length-1].signal = null;
  }
  saveHistory();
  updateChart();
  renderSignals();
}

/* ØªØ§Ø¨Ø¹ÛŒ Ú©Ù‡ Ú©Ø§Ø±Ø¨Ø± Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ Ø³ÛŒÚ¯Ù†Ø§Ù„ Ù…ÛŒâ€ŒØ²Ù†Ø¯ (Ù†Ù…Ø§ÛŒØ´ Ø®Ù„Ø§ØµÙ‡ Ùˆ Ù‡Ø´Ø¯Ø§Ø±) */
function signal(){
  if(historyData.length===0){ document.getElementById('signalResult').innerText = 'Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡'; return; }
  const last = historyData[historyData.length-1];
  const support = last.avg * 0.985;
  const resistance = last.avg * 1.015;
  let resText='';
  if(last.bubble < -20000 && last.price <= support){
    resText = `ğŸŸ¢ Ø³ÛŒÚ¯Ù†Ø§Ù„ ÙˆØ±ÙˆØ¯ Ù‚ÙˆÛŒ â€” Ù‚ÛŒÙ…Øª Ù†Ø²Ø¯ÛŒÚ© Ø­Ù…Ø§ÛŒØª: ${support.toLocaleString()} | RSI: ${last.rsi.toFixed(2)}`;
    playSound(); notify(resText); pushSignal('ÙˆØ±ÙˆØ¯', resText);
    historyData[historyData.length-1].signal = 'entry';
  } else if(last.bubble > 20000 && last.price >= resistance){
    resText = `ğŸ”´ Ø³ÛŒÚ¯Ù†Ø§Ù„ Ø®Ø±ÙˆØ¬ Ù‚ÙˆÛŒ â€” Ù‚ÛŒÙ…Øª Ù†Ø²Ø¯ÛŒÚ© Ù…Ù‚Ø§ÙˆÙ…Øª: ${resistance.toLocaleString()} | RSI: ${last.rsi.toFixed(2)}`;
    playSound(); notify(resText); pushSignal('Ø®Ø±ÙˆØ¬', resText);
    historyData[historyData.length-1].signal = 'exit';
  } else {
    // Ø§Ú¯Ø± Ø´Ø±Ø§ÛŒØ· ÙˆØ±ÙˆØ¯/Ø®Ø±ÙˆØ¬ Ù‚ÙˆÛŒ Ù†Ø¨ÙˆØ¯ØŒ ÛŒÚ© Ù¾ÛŒØ§Ù… ØªØ­Ù„ÛŒÙ„ÛŒâ€ŒØªØ± Ø®Ø±ÙˆØ¬ Ø¨Ø¯Ù‡
    resText = `âš– Ø¨Ø§Ø²Ø§Ø± Ø®Ù†Ø«ÛŒ â€” Ø­Ø¨Ø§Ø¨: ${last.bubble.toLocaleString()} ØªÙˆÙ…Ø§Ù† | RSI: ${last.rsi.toFixed(2)} | Ø±ÙˆÙ†Ø¯ Ø¯Ù„Ø§Ø±: ${last.usdTrend} | Ø§Ù†Ø³: ${last.ounceTrend}`;
    pushSignal('Ø®Ù†Ø«ÛŒ', resText);
    historyData[historyData.length-1].signal = null;
  }
  saveHistory();
  updateChart();
  renderSignals();
  document.getElementById('signalResult').innerText = resText;
}

/* -------------------------
  ÙˆØ¶Ø¹ÛŒØª Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù†
--------------------------*/
function toggleNotification(){
  notifyActive = !notifyActive;
  localStorage.setItem('notifyActive', notifyActive ? '1' : '0');
  const btn = document.getElementById('notifyBtn');
  if(notifyActive){ btn.className = 'toggle on'; btn.innerText = 'ğŸ”” Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† Ø±ÙˆØ´Ù†'; }
  else { btn.className = 'toggle off'; btn.innerText = 'ğŸ”” Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† Ø®Ø§Ù…ÙˆØ´'; }
}

/* -------------------------
  Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ù†Ù…ÙˆØ¯Ø§Ø± Ùˆ Ø³ÛŒÚ¯Ù†Ø§Ù„â€ŒÙ‡Ø§
--------------------------*/
function init(){
  updateChart();
  renderSignals();
  // Ø§Ú¯Ø± apiCounter Ø§Ø² Ù†ÛŒÙ…Ù‡ Ø´Ø¨ Ú¯Ø°Ø´ØªÙ‡ Ø±ÛŒØ³Øª Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯Ø› Ø§Ú¯Ø± Ø®ÙˆØ§Ø³ØªÛŒ Ù…ÛŒâ€ŒØªÙˆÙ†Ù… Ù‚Ø§Ø¨Ù„ÛŒØª Ø±ÛŒØ³Øª Ø±ÙˆØ²Ø§Ù†Ù‡ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†Ù….
}
init();

/* -------------------------
  ØªÙˆØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ Ø§Ø¶Ø§ÙÛŒ (Ù…Ø«Ù„Ø§Ù‹ Ø¨Ø±Ø§ÛŒ Ø±ÛŒØ³Øª Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡ ÛŒØ§ Ù¾Ø§Ú©â€ŒØ³Ø§Ø²ÛŒ)
--------------------------*/
window.resetApiCounter = function(){
  if(confirm('Ø¢ÛŒØ§ Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡ API Ø±Ø§ Ø±ÛŒØ³Øª Ù…ÛŒâ€ŒÚ©Ù†ÛŒØ¯ØŸ (Ø±ÙˆØ²Ø§Ù†Ù‡)')){
    setApiCounter(0);
    alert('Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡ Ø±ÛŒØ³Øª Ø´Ø¯.');
  }
};
window.clearAllData = function(){
  if(!confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù‡Ù…Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ù¾Ø§Ú© Ø´ÙˆÙ†Ø¯ØŸ')) return;
  historyData = [];
  signals = [];
  saveHistory(); saveSignals();
  updateChart(); renderSignals();
  document.getElementById('goldResult').innerText = 'Ù‡Ù…Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ù¾Ø§Ú© Ø´Ø¯.';
};

</script>
</body>
</html>
